var d2s=function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=6)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(3),n=r(4),a=function(){function t(t){void 0===t&&(t=1024),this.littleEndian=!0,this.length=0,this.offset=0,this.noAssert=!1,this.poolSize=t,this.buffer=i.Buffer.alloc(this.poolSize,0)}return t.prototype._CheckAlloc=function(t){for(void 0===t&&(t=0);this.length+t>this.buffer.length;)this.buffer=i.Buffer.concat([this.buffer,i.Buffer.alloc(this.poolSize,0)])},t.prototype._Increment=function(t){this.offset+=t,this.offset>this.length&&(this.length=this.offset,this._CheckAlloc())},t.prototype.SetEndianness=function(t){return t===n.Endianness.be?this.SetBigEndian():this.SetLittleEndian()},t.prototype.GetEndianness=function(){return this.littleEndian?n.Endianness.le:n.Endianness.be},t.prototype.SetLittleEndian=function(){return this.littleEndian=!0,this},t.prototype.SetBigEndian=function(){return this.littleEndian=!1,this},t.prototype.toArray=function(){return new Uint8Array(this.buffer.slice(0,this.length))},t.prototype.WriteArray=function(t){this._CheckAlloc(t.byteLength);var e=i.Buffer.from(t);return e.copy(this.buffer,this.offset),this._Increment(e.length),this},t.prototype.WriteStringNullTerminated=function(t){var e=t+"\0";return this._CheckAlloc(e.length),this.buffer.write(e,this.offset,e.length,"utf8"),this._Increment(e.length),this},t.prototype.WriteString=function(t,e){return e=e||t.length,this._CheckAlloc(e),this.buffer.write(t,this.offset,e,"utf8"),this._Increment(e),this},t.prototype.WriteUInt8=function(t){return this._CheckAlloc(1),this.buffer.writeUInt8(t,this.offset,this.noAssert),this._Increment(1),this},t.prototype.WriteInt8=function(t){return this._CheckAlloc(1),this.buffer.writeInt8(t,this.offset,this.noAssert),this._Increment(1),this},t.prototype.WriteUInt16=function(t){return this._CheckAlloc(2),this.littleEndian?this.buffer.writeUInt16LE(t,this.offset,this.noAssert):this.buffer.writeUInt16BE(t,this.offset,this.noAssert),this._Increment(2),this},t.prototype.WriteInt16=function(t){return this._CheckAlloc(2),this.littleEndian?this.buffer.writeInt16LE(t,this.offset,this.noAssert):this.buffer.writeInt16BE(t,this.offset,this.noAssert),this._Increment(2),this},t.prototype.WriteUInt32=function(t){return this._CheckAlloc(4),this.littleEndian?this.buffer.writeUInt32LE(t,this.offset,this.noAssert):this.buffer.writeUInt32BE(t,this.offset,this.noAssert),this._Increment(4),this},t.prototype.WriteInt32=function(t){return this._CheckAlloc(4),this.littleEndian?this.buffer.writeInt32LE(t,this.offset,this.noAssert):this.buffer.writeInt32BE(t,this.offset,this.noAssert),this._Increment(4),this},t.prototype.WriteUInt=function(t,e){return this._CheckAlloc(e),this.littleEndian?this.buffer.writeUIntLE(t,this.offset,e,this.noAssert):this.buffer.writeUIntBE(t,this.offset,e,this.noAssert),this._Increment(e),this},t.prototype.WriteInt=function(t,e){return this._CheckAlloc(e),this.littleEndian?this.buffer.writeIntLE(t,this.offset,e,this.noAssert):this.buffer.writeIntBE(t,this.offset,e,this.noAssert),this._Increment(e),this},t.prototype.Skip=function(t){return this._Increment(t),this},t.prototype.Seek=function(t){return this.offset=t,this.offset>this.length&&(this.length=this.offset,this._CheckAlloc()),this},t.prototype.Position=function(){return this.offset},t.prototype.Peek=function(t){return void 0===t&&(t=1),this._CheckAlloc(t),this.littleEndian?this.buffer.readUIntLE(this.offset,t,this.noAssert):this.buffer.readUIntBE(this.offset,t,this.noAssert)},t.prototype.Buffer=function(){return this.buffer},t.prototype.SetLength=function(t){return this.length=t,this},t.prototype.Length=function(){return this.length},t}();e.BinaryWriter=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(3),n=r(4),a=function(){function t(t){this.littleEndian=!0,this.noAssert=!1,this.offset=0,this.buffer=i.Buffer.from(t)}return t.prototype._ReadArray=function(t){var e=this.buffer.slice(this.offset,this.offset+t);return this.offset+=t,new Uint8Array(e)},t.prototype._ReadString=function(t){var e=this.buffer.toString("utf8",this.offset,this.offset+t);return this.offset+=t,e},t.prototype._ReadNullTerminatedString=function(){for(var t=this.offset;this.buffer.readUInt8(this.offset,this.noAssert);)this.offset++;return this.buffer.toString("utf8",t,this.offset++)},t.prototype.SetEndianness=function(t){return t===n.Endianness.be?this.SetBigEndian():this.SetLittleEndian()},t.prototype.GetEndianness=function(){return this.littleEndian?n.Endianness.le:n.Endianness.be},t.prototype.SetLittleEndian=function(){return this.littleEndian=!0,this},t.prototype.SetBigEndian=function(){return this.littleEndian=!1,this},t.prototype.ReadArray=function(t){return this._ReadArray(t)},t.prototype.ReadUInt8=function(){var t=this.buffer.readUInt8(this.offset,this.noAssert);return this.offset+=1,t},t.prototype.ReadInt8=function(){var t=this.buffer.readInt8(this.offset,this.noAssert);return this.offset+=1,t},t.prototype.ReadUInt16=function(){var t=this.littleEndian?this.buffer.readUInt16LE(this.offset,this.noAssert):this.buffer.readUInt16BE(this.offset,this.noAssert);return this.offset+=2,t},t.prototype.ReadInt16=function(){var t=this.littleEndian?this.buffer.readInt16LE(this.offset,this.noAssert):this.buffer.readInt16BE(this.offset,this.noAssert);return this.offset+=2,t},t.prototype.ReadUInt32=function(){var t=this.littleEndian?this.buffer.readUInt32LE(this.offset,this.noAssert):this.buffer.readUInt32BE(this.offset,this.noAssert);return this.offset+=4,t},t.prototype.ReadInt32=function(){var t=this.littleEndian?this.buffer.readInt32LE(this.offset,this.noAssert):this.buffer.readInt32BE(this.offset,this.noAssert);return this.offset+=4,t},t.prototype.ReadUInt=function(t){var e=this.littleEndian?this.buffer.readUIntLE(this.offset,t,this.noAssert):this.buffer.readUIntBE(this.offset,t,this.noAssert);return this.offset+=t,e},t.prototype.ReadInt=function(t){var e=this.littleEndian?this.buffer.readIntLE(this.offset,t,this.noAssert):this.buffer.readIntBE(this.offset,t,this.noAssert);return this.offset+=t,e},t.prototype.Skip=function(t){return this.offset+=t,this},t.prototype.Seek=function(t){return this.offset=t,this},t.prototype.Position=function(){return this.offset},t.prototype.ReadString=function(t){return null==t?this._ReadNullTerminatedString():this._ReadString(t)},t.prototype.Buffer=function(){return this.buffer},t}();e.BinaryReader=a},function(t,e,r){"use strict";var i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var n=i(r(13));e._readBits=function(t,e,r,i){t.Seek(e+Math.floor(r/8));var a=n.default.fromNumber(t.ReadUInt(Math.ceil((i+r%8)/8)),!0),s=a.shiftRightUnsigned(r%8),o=n.default.fromNumber(1,!0).shiftLeft(i).subtract(1);return(a=s.and(o)).toNumber()},e._writeBits=function t(e,r,i,a,s){e.Seek(i+Math.floor(a/8));var o=Math.ceil((s+a%8)/8),u=n.default.fromNumber(e.Peek(o),!0);if("number"==typeof r){var c=n.default.fromNumber(r,!0),f=n.default.fromNumber(1,!0).shiftLeft(s).subtract(1),h=f.shiftLeft(a%8);u=(u=u.and(h.not())).xor(c.and(f).shiftLeft(a%8)),e.WriteUInt(u.toNumber(),o)}else if(r instanceof Uint8Array)for(var l=0;l<r.length;l++)t(e,r[l],i,a+8*l,8)}},function(t,e,r){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var i=r(10),n=r(11),a=r(12);function s(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(t,e){if(s()<e)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=u.prototype:(null===t&&(t=new u(e)),t.length=e),t}function u(t,e,r){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(t,e,r);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return h(this,t)}return c(this,t,e,r)}function c(t,e,r,i){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,r,i){if(e.byteLength,r<0||e.byteLength<r)throw new RangeError("'offset' is out of bounds");if(e.byteLength<r+(i||0))throw new RangeError("'length' is out of bounds");e=void 0===r&&void 0===i?new Uint8Array(e):void 0===i?new Uint8Array(e,r):new Uint8Array(e,r,i);u.TYPED_ARRAY_SUPPORT?(t=e).__proto__=u.prototype:t=l(t,e);return t}(t,e,r,i):"string"==typeof e?function(t,e,r){"string"==typeof r&&""!==r||(r="utf8");if(!u.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var i=0|_(e,r),n=(t=o(t,i)).write(e,r);n!==i&&(t=t.slice(0,n));return t}(t,e,r):function(t,e){if(u.isBuffer(e)){var r=0|d(e.length);return 0===(t=o(t,r)).length?t:(e.copy(t,0,0,r),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(i=e.length)!=i?o(t,0):l(t,e);if("Buffer"===e.type&&a(e.data))return l(t,e.data)}var i;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function f(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function h(t,e){if(f(e),t=o(t,e<0?0:0|d(e)),!u.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function l(t,e){var r=e.length<0?0:0|d(e.length);t=o(t,r);for(var i=0;i<r;i+=1)t[i]=255&e[i];return t}function d(t){if(t>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|t}function _(t,e){if(u.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return D(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return Y(t).length;default:if(i)return D(t).length;e=(""+e).toLowerCase(),i=!0}}function p(t,e,r){var i=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return U(this,e,r);case"utf8":case"utf-8":return x(this,e,r);case"ascii":return I(this,e,r);case"latin1":case"binary":return R(this,e,r);case"base64":return E(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,e,r);default:if(i)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),i=!0}}function g(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}function m(t,e,r,i,n){if(0===t.length)return-1;if("string"==typeof r?(i=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=n?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(n)return-1;r=t.length-1}else if(r<0){if(!n)return-1;r=0}if("string"==typeof e&&(e=u.from(e,i)),u.isBuffer(e))return 0===e.length?-1:v(t,e,r,i,n);if("number"==typeof e)return e&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):v(t,[e],r,i,n);throw new TypeError("val must be string, number or Buffer")}function v(t,e,r,i,n){var a,s=1,o=t.length,u=e.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(t.length<2||e.length<2)return-1;s=2,o/=2,u/=2,r/=2}function c(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(n){var f=-1;for(a=r;a<o;a++)if(c(t,a)===c(e,-1===f?0:a-f)){if(-1===f&&(f=a),a-f+1===u)return f*s}else-1!==f&&(a-=a-f),f=-1}else for(r+u>o&&(r=o-u),a=r;a>=0;a--){for(var h=!0,l=0;l<u;l++)if(c(t,a+l)!==c(e,l)){h=!1;break}if(h)return a}return-1}function y(t,e,r,i){r=Number(r)||0;var n=t.length-r;i?(i=Number(i))>n&&(i=n):i=n;var a=e.length;if(a%2!=0)throw new TypeError("Invalid hex string");i>a/2&&(i=a/2);for(var s=0;s<i;++s){var o=parseInt(e.substr(2*s,2),16);if(isNaN(o))return s;t[r+s]=o}return s}function w(t,e,r,i){return z(D(e,t.length-r),t,r,i)}function B(t,e,r,i){return z(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,i)}function b(t,e,r,i){return B(t,e,r,i)}function A(t,e,r,i){return z(Y(e),t,r,i)}function k(t,e,r,i){return z(function(t,e){for(var r,i,n,a=[],s=0;s<t.length&&!((e-=2)<0);++s)r=t.charCodeAt(s),i=r>>8,n=r%256,a.push(n),a.push(i);return a}(e,t.length-r),t,r,i)}function E(t,e,r){return 0===e&&r===t.length?i.fromByteArray(t):i.fromByteArray(t.slice(e,r))}function x(t,e,r){r=Math.min(t.length,r);for(var i=[],n=e;n<r;){var a,s,o,u,c=t[n],f=null,h=c>239?4:c>223?3:c>191?2:1;if(n+h<=r)switch(h){case 1:c<128&&(f=c);break;case 2:128==(192&(a=t[n+1]))&&(u=(31&c)<<6|63&a)>127&&(f=u);break;case 3:a=t[n+1],s=t[n+2],128==(192&a)&&128==(192&s)&&(u=(15&c)<<12|(63&a)<<6|63&s)>2047&&(u<55296||u>57343)&&(f=u);break;case 4:a=t[n+1],s=t[n+2],o=t[n+3],128==(192&a)&&128==(192&s)&&128==(192&o)&&(u=(15&c)<<18|(63&a)<<12|(63&s)<<6|63&o)>65535&&u<1114112&&(f=u)}null===f?(f=65533,h=1):f>65535&&(f-=65536,i.push(f>>>10&1023|55296),f=56320|1023&f),i.push(f),n+=h}return function(t){var e=t.length;if(e<=S)return String.fromCharCode.apply(String,t);var r="",i=0;for(;i<e;)r+=String.fromCharCode.apply(String,t.slice(i,i+=S));return r}(i)}e.Buffer=u,e.SlowBuffer=function(t){+t!=t&&(t=0);return u.alloc(+t)},e.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=s(),u.poolSize=8192,u._augment=function(t){return t.__proto__=u.prototype,t},u.from=function(t,e,r){return c(null,t,e,r)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(t,e,r){return function(t,e,r,i){return f(e),e<=0?o(t,e):void 0!==r?"string"==typeof i?o(t,e).fill(r,i):o(t,e).fill(r):o(t,e)}(null,t,e,r)},u.allocUnsafe=function(t){return h(null,t)},u.allocUnsafeSlow=function(t){return h(null,t)},u.isBuffer=function(t){return!(null==t||!t._isBuffer)},u.compare=function(t,e){if(!u.isBuffer(t)||!u.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,i=e.length,n=0,a=Math.min(r,i);n<a;++n)if(t[n]!==e[n]){r=t[n],i=e[n];break}return r<i?-1:i<r?1:0},u.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(t,e){if(!a(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return u.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var i=u.allocUnsafe(e),n=0;for(r=0;r<t.length;++r){var s=t[r];if(!u.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(i,n),n+=s.length}return i},u.byteLength=_,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},u.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},u.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},u.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?x(this,0,t):p.apply(this,arguments)},u.prototype.equals=function(t){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===u.compare(this,t)},u.prototype.inspect=function(){var t="",r=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},u.prototype.compare=function(t,e,r,i,n){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===i&&(i=0),void 0===n&&(n=this.length),e<0||r>t.length||i<0||n>this.length)throw new RangeError("out of range index");if(i>=n&&e>=r)return 0;if(i>=n)return-1;if(e>=r)return 1;if(this===t)return 0;for(var a=(n>>>=0)-(i>>>=0),s=(r>>>=0)-(e>>>=0),o=Math.min(a,s),c=this.slice(i,n),f=t.slice(e,r),h=0;h<o;++h)if(c[h]!==f[h]){a=c[h],s=f[h];break}return a<s?-1:s<a?1:0},u.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},u.prototype.indexOf=function(t,e,r){return m(this,t,e,r,!0)},u.prototype.lastIndexOf=function(t,e,r){return m(this,t,e,r,!1)},u.prototype.write=function(t,e,r,i){if(void 0===e)i="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)i=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===i&&(i="utf8")):(i=r,r=void 0)}var n=this.length-e;if((void 0===r||r>n)&&(r=n),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var a=!1;;)switch(i){case"hex":return y(this,t,e,r);case"utf8":case"utf-8":return w(this,t,e,r);case"ascii":return B(this,t,e,r);case"latin1":case"binary":return b(this,t,e,r);case"base64":return A(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,t,e,r);default:if(a)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),a=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function I(t,e,r){var i="";r=Math.min(t.length,r);for(var n=e;n<r;++n)i+=String.fromCharCode(127&t[n]);return i}function R(t,e,r){var i="";r=Math.min(t.length,r);for(var n=e;n<r;++n)i+=String.fromCharCode(t[n]);return i}function U(t,e,r){var i=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>i)&&(r=i);for(var n="",a=e;a<r;++a)n+=j(t[a]);return n}function O(t,e,r){for(var i=t.slice(e,r),n="",a=0;a<i.length;a+=2)n+=String.fromCharCode(i[a]+256*i[a+1]);return n}function W(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function P(t,e,r,i,n,a){if(!u.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<a)throw new RangeError('"value" argument is out of bounds');if(r+i>t.length)throw new RangeError("Index out of range")}function M(t,e,r,i){e<0&&(e=65535+e+1);for(var n=0,a=Math.min(t.length-r,2);n<a;++n)t[r+n]=(e&255<<8*(i?n:1-n))>>>8*(i?n:1-n)}function L(t,e,r,i){e<0&&(e=4294967295+e+1);for(var n=0,a=Math.min(t.length-r,4);n<a;++n)t[r+n]=e>>>8*(i?n:3-n)&255}function T(t,e,r,i,n,a){if(r+i>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function C(t,e,r,i,a){return a||T(t,0,r,4),n.write(t,e,r,i,23,4),r+4}function q(t,e,r,i,a){return a||T(t,0,r,8),n.write(t,e,r,i,52,8),r+8}u.prototype.slice=function(t,e){var r,i=this.length;if((t=~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),(e=void 0===e?i:~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),e<t&&(e=t),u.TYPED_ARRAY_SUPPORT)(r=this.subarray(t,e)).__proto__=u.prototype;else{var n=e-t;r=new u(n,void 0);for(var a=0;a<n;++a)r[a]=this[a+t]}return r},u.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||W(t,e,this.length);for(var i=this[t],n=1,a=0;++a<e&&(n*=256);)i+=this[t+a]*n;return i},u.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||W(t,e,this.length);for(var i=this[t+--e],n=1;e>0&&(n*=256);)i+=this[t+--e]*n;return i},u.prototype.readUInt8=function(t,e){return e||W(t,1,this.length),this[t]},u.prototype.readUInt16LE=function(t,e){return e||W(t,2,this.length),this[t]|this[t+1]<<8},u.prototype.readUInt16BE=function(t,e){return e||W(t,2,this.length),this[t]<<8|this[t+1]},u.prototype.readUInt32LE=function(t,e){return e||W(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},u.prototype.readUInt32BE=function(t,e){return e||W(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},u.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||W(t,e,this.length);for(var i=this[t],n=1,a=0;++a<e&&(n*=256);)i+=this[t+a]*n;return i>=(n*=128)&&(i-=Math.pow(2,8*e)),i},u.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||W(t,e,this.length);for(var i=e,n=1,a=this[t+--i];i>0&&(n*=256);)a+=this[t+--i]*n;return a>=(n*=128)&&(a-=Math.pow(2,8*e)),a},u.prototype.readInt8=function(t,e){return e||W(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},u.prototype.readInt16LE=function(t,e){e||W(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(t,e){e||W(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(t,e){return e||W(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},u.prototype.readInt32BE=function(t,e){return e||W(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},u.prototype.readFloatLE=function(t,e){return e||W(t,4,this.length),n.read(this,t,!0,23,4)},u.prototype.readFloatBE=function(t,e){return e||W(t,4,this.length),n.read(this,t,!1,23,4)},u.prototype.readDoubleLE=function(t,e){return e||W(t,8,this.length),n.read(this,t,!0,52,8)},u.prototype.readDoubleBE=function(t,e){return e||W(t,8,this.length),n.read(this,t,!1,52,8)},u.prototype.writeUIntLE=function(t,e,r,i){(t=+t,e|=0,r|=0,i)||P(this,t,e,r,Math.pow(2,8*r)-1,0);var n=1,a=0;for(this[e]=255&t;++a<r&&(n*=256);)this[e+a]=t/n&255;return e+r},u.prototype.writeUIntBE=function(t,e,r,i){(t=+t,e|=0,r|=0,i)||P(this,t,e,r,Math.pow(2,8*r)-1,0);var n=r-1,a=1;for(this[e+n]=255&t;--n>=0&&(a*=256);)this[e+n]=t/a&255;return e+r},u.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||P(this,t,e,1,255,0),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},u.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||P(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):M(this,t,e,!0),e+2},u.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||P(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):M(this,t,e,!1),e+2},u.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||P(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):L(this,t,e,!0),e+4},u.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||P(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):L(this,t,e,!1),e+4},u.prototype.writeIntLE=function(t,e,r,i){if(t=+t,e|=0,!i){var n=Math.pow(2,8*r-1);P(this,t,e,r,n-1,-n)}var a=0,s=1,o=0;for(this[e]=255&t;++a<r&&(s*=256);)t<0&&0===o&&0!==this[e+a-1]&&(o=1),this[e+a]=(t/s>>0)-o&255;return e+r},u.prototype.writeIntBE=function(t,e,r,i){if(t=+t,e|=0,!i){var n=Math.pow(2,8*r-1);P(this,t,e,r,n-1,-n)}var a=r-1,s=1,o=0;for(this[e+a]=255&t;--a>=0&&(s*=256);)t<0&&0===o&&0!==this[e+a+1]&&(o=1),this[e+a]=(t/s>>0)-o&255;return e+r},u.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||P(this,t,e,1,127,-128),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},u.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||P(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):M(this,t,e,!0),e+2},u.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||P(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):M(this,t,e,!1),e+2},u.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||P(this,t,e,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):L(this,t,e,!0),e+4},u.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||P(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):L(this,t,e,!1),e+4},u.prototype.writeFloatLE=function(t,e,r){return C(this,t,e,!0,r)},u.prototype.writeFloatBE=function(t,e,r){return C(this,t,e,!1,r)},u.prototype.writeDoubleLE=function(t,e,r){return q(this,t,e,!0,r)},u.prototype.writeDoubleBE=function(t,e,r){return q(this,t,e,!1,r)},u.prototype.copy=function(t,e,r,i){if(r||(r=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<r&&(i=r),i===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-r&&(i=t.length-e+r);var n,a=i-r;if(this===t&&r<e&&e<i)for(n=a-1;n>=0;--n)t[n+e]=this[n+r];else if(a<1e3||!u.TYPED_ARRAY_SUPPORT)for(n=0;n<a;++n)t[n+e]=this[n+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+a),e);return a},u.prototype.fill=function(t,e,r,i){if("string"==typeof t){if("string"==typeof e?(i=e,e=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),1===t.length){var n=t.charCodeAt(0);n<256&&(t=n)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!u.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var a;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(a=e;a<r;++a)this[a]=t;else{var s=u.isBuffer(t)?t:D(new u(t,i).toString()),o=s.length;for(a=0;a<r-e;++a)this[a+e]=s[a%o]}return this};var N=/[^+\/0-9A-Za-z-_]/g;function j(t){return t<16?"0"+t.toString(16):t.toString(16)}function D(t,e){var r;e=e||1/0;for(var i=t.length,n=null,a=[],s=0;s<i;++s){if((r=t.charCodeAt(s))>55295&&r<57344){if(!n){if(r>56319){(e-=3)>-1&&a.push(239,191,189);continue}if(s+1===i){(e-=3)>-1&&a.push(239,191,189);continue}n=r;continue}if(r<56320){(e-=3)>-1&&a.push(239,191,189),n=r;continue}r=65536+(n-55296<<10|r-56320)}else n&&(e-=3)>-1&&a.push(239,191,189);if(n=null,r<128){if((e-=1)<0)break;a.push(r)}else if(r<2048){if((e-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function Y(t){return i.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(N,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function z(t,e,r,i){for(var n=0;n<i&&!(n+r>=e.length||n>=t.length);++n)e[n+r]=t[n];return n}}).call(this,r(9))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.be=0]="be",t[t.le=1]="le"}(e.Endianness||(e.Endianness={}))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(1),n=r(0),a=r(2),s=["normal","nm","hell"];function o(t,e){if(""===t)return 0;if(!t)return-1;var r=e.skills.findIndex(function(e){return e&&e.s==t});return r>=0?r:0}function u(t){var e={},r=new i.BinaryReader(t).SetLittleEndian();return e.act_i={},e.act_i.introduced=1===r.ReadUInt16(),e.act_i.den_of_evil=f(r.ReadArray(2)),e.act_i.sisters_burial_grounds=f(r.ReadArray(2)),e.act_i.tools_of_the_trade=f(r.ReadArray(2)),e.act_i.the_search_for_cain=f(r.ReadArray(2)),e.act_i.the_forgotten_tower=f(r.ReadArray(2)),e.act_i.sisters_to_the_slaughter=f(r.ReadArray(2)),e.act_i.completed=1===r.ReadUInt16(),e.act_ii={},e.act_ii.introduced=1===r.ReadUInt16(),e.act_ii.radaments_lair=f(r.ReadArray(2)),e.act_ii.the_horadric_staff=f(r.ReadArray(2)),e.act_ii.tainted_sun=f(r.ReadArray(2)),e.act_ii.arcane_sanctuary=f(r.ReadArray(2)),e.act_ii.the_summoner=f(r.ReadArray(2)),e.act_ii.the_seven_tombs=f(r.ReadArray(2)),e.act_ii.completed=1===r.ReadUInt16(),e.act_iii={},e.act_iii.introduced=1===r.ReadUInt16(),e.act_iii.lam_esens_tome=f(r.ReadArray(2)),e.act_iii.khalims_will=f(r.ReadArray(2)),e.act_iii.blade_of_the_old_religion=f(r.ReadArray(2)),e.act_iii.the_golden_bird=f(r.ReadArray(2)),e.act_iii.the_blackened_temple=f(r.ReadArray(2)),e.act_iii.the_guardian=f(r.ReadArray(2)),e.act_iii.completed=1===r.ReadUInt16(),e.act_iv={},e.act_iv.introduced=1===r.ReadUInt16(),e.act_iv.the_fallen_angel=f(r.ReadArray(2)),e.act_iv.terrors_end=f(r.ReadArray(2)),e.act_iv.hellforge=f(r.ReadArray(2)),e.act_iv.completed=1===r.ReadUInt16(),r.Skip(10),e.act_v={},e.act_v.introduced=1===r.ReadUInt16(),e.act_v.siege_on_harrogath=f(r.ReadArray(2)),e.act_v.rescue_on_mount_arreat=f(r.ReadArray(2)),e.act_v.prison_of_ice=f(r.ReadArray(2)),e.act_v.betrayal_of_harrogath=f(r.ReadArray(2)),e.act_v.rite_of_passage=f(r.ReadArray(2)),e.act_v.eve_of_destruction=f(r.ReadArray(2)),e.act_v.completed=1===r.ReadUInt16(),r.Skip(12),e}function c(t){return new n.BinaryWriter(96).SetLittleEndian().SetLength(96).WriteUInt16(1).WriteArray(h(t.act_i.den_of_evil)).WriteArray(h(t.act_i.sisters_burial_grounds)).WriteArray(h(t.act_i.tools_of_the_trade)).WriteArray(h(t.act_i.the_search_for_cain)).WriteArray(h(t.act_i.the_forgotten_tower)).WriteArray(h(t.act_i.sisters_to_the_slaughter)).WriteUInt16(+t.act_i.completed||+t.act_i.sisters_to_the_slaughter.is_completed).WriteUInt16(+t.act_ii.introduced||+t.act_i.sisters_to_the_slaughter.is_completed).WriteArray(h(t.act_ii.radaments_lair)).WriteArray(h(t.act_ii.the_horadric_staff)).WriteArray(h(t.act_ii.tainted_sun)).WriteArray(h(t.act_ii.arcane_sanctuary)).WriteArray(h(t.act_ii.the_summoner)).WriteArray(h(t.act_ii.the_seven_tombs)).WriteUInt16(+t.act_ii.completed||+t.act_ii.the_seven_tombs.is_completed).WriteUInt16(+t.act_iii.introduced||+t.act_ii.the_seven_tombs.is_completed).WriteArray(h(t.act_iii.lam_esens_tome)).WriteArray(h(t.act_iii.khalims_will)).WriteArray(h(t.act_iii.blade_of_the_old_religion)).WriteArray(h(t.act_iii.the_golden_bird)).WriteArray(h(t.act_iii.the_blackened_temple)).WriteArray(h(t.act_iii.the_guardian)).WriteUInt16(+t.act_iii.completed||+t.act_iii.the_guardian.is_completed).WriteUInt16(+t.act_iv.introduced||+t.act_iii.the_guardian.is_completed).WriteArray(h(t.act_iv.the_fallen_angel)).WriteArray(h(t.act_iv.terrors_end)).WriteArray(h(t.act_iv.hellforge)).WriteUInt16(+t.act_iv.completed||+t.act_iv.terrors_end.is_completed).Skip(10).WriteUInt16(+t.act_v.introduced||+t.act_iv.terrors_end.is_completed).WriteArray(h(t.act_v.siege_on_harrogath)).WriteArray(h(t.act_v.rescue_on_mount_arreat)).WriteArray(h(t.act_v.prison_of_ice)).WriteArray(h(t.act_v.betrayal_of_harrogath)).WriteArray(h(t.act_v.rite_of_passage)).WriteArray(h(t.act_v.eve_of_destruction)).WriteUInt16(+t.act_v.completed||+t.act_v.eve_of_destruction.is_completed).Skip(12).toArray()}function f(t){var e={},r=new i.BinaryReader(t).SetLittleEndian(),n=r.Position();return a._readBits(r,n,15,1)&&(e.unk15=!0),a._readBits(r,n,14,1)&&(e.unk14=!0),e.done_recently=1===a._readBits(r,n,13,1),e.closed=1===a._readBits(r,n,12,1),a._readBits(r,n,11,1)&&(e.unk11=!0),a._readBits(r,n,10,1)&&(e.unk10=!0),a._readBits(r,n,9,1)&&(e.unk9=!0),a._readBits(r,n,8,1)&&(e.unk8=!0),a._readBits(r,n,7,1)&&(e.consumed_scroll=!0),a._readBits(r,n,6,1)&&(e.unk6=!0),a._readBits(r,n,5,1)&&(e.unk5=!0),a._readBits(r,n,4,1)&&(e.unk4=!0),a._readBits(r,n,3,1)&&(e.unk3=!0),e.is_received=1===a._readBits(r,n,2,1),e.is_requirement_completed=1===a._readBits(r,n,1,1),e.is_completed=1===a._readBits(r,n,0,1),e}function h(t){var e=new n.BinaryWriter(2).SetLittleEndian().SetLength(2),r=e.Position();return a._writeBits(e,+t.unk15,r,15,1),a._writeBits(e,+t.done_recently,r,13,1),a._writeBits(e,+t.closed,r,12,1),a._writeBits(e,+t.unk14,r,14,1),a._writeBits(e,+t.unk11,r,11,1),a._writeBits(e,+t.unk10,r,10,1),a._writeBits(e,+t.unk9,r,9,1),a._writeBits(e,+t.unk8,r,8,1),a._writeBits(e,+t.consumed_scroll,r,7,1),a._writeBits(e,+t.unk6,r,6,1),a._writeBits(e,+t.unk5,r,5,1),a._writeBits(e,+t.unk4,r,4,1),a._writeBits(e,+t.unk3,r,3,1),a._writeBits(e,+t.is_received,r,2,1),a._writeBits(e,+t.is_requirement_completed,r,1,1),a._writeBits(e,+t.is_completed,r,0,1),e.toArray()}function l(t){var e={},r=new i.BinaryReader(t).SetLittleEndian();r.Skip(2);var n=r.Position();return e.act_i={},e.act_i.rogue_encampement=1===a._readBits(r,n,0,1),e.act_i.cold_plains=1===a._readBits(r,n,1,1),e.act_i.stony_field=1===a._readBits(r,n,2,1),e.act_i.dark_woods=1===a._readBits(r,n,3,1),e.act_i.black_marsh=1===a._readBits(r,n,4,1),e.act_i.outer_cloister=1===a._readBits(r,n,5,1),e.act_i.jail_lvl_1=1===a._readBits(r,n,6,1),e.act_i.inner_cloister=1===a._readBits(r,n,7,1),e.act_i.catacombs_lvl_2=1===a._readBits(r,n,8,1),e.act_ii={},e.act_ii.lut_gholein=1===a._readBits(r,n,9,1),e.act_ii.sewers_lvl_2=1===a._readBits(r,n,10,1),e.act_ii.dry_hills=1===a._readBits(r,n,11,1),e.act_ii.halls_of_the_dead_lvl_2=1===a._readBits(r,n,12,1),e.act_ii.far_oasis=1===a._readBits(r,n,13,1),e.act_ii.lost_city=1===a._readBits(r,n,14,1),e.act_ii.palace_cellar_lvl_1=1===a._readBits(r,n,15,1),e.act_ii.arcane_sanctuary=1===a._readBits(r,n,16,1),e.act_ii.canyon_of_the_magi=1===a._readBits(r,n,17,1),e.act_iii={},e.act_iii.kurast_docks=1===a._readBits(r,n,18,1),e.act_iii.spider_forest=1===a._readBits(r,n,19,1),e.act_iii.great_marsh=1===a._readBits(r,n,20,1),e.act_iii.flayer_jungle=1===a._readBits(r,n,21,1),e.act_iii.lower_kurast=1===a._readBits(r,n,22,1),e.act_iii.kurast_bazaar=1===a._readBits(r,n,23,1),e.act_iii.upper_kurast=1===a._readBits(r,n,24,1),e.act_iii.travincal=1===a._readBits(r,n,25,1),e.act_iii.durance_of_hate_lvl_2=1===a._readBits(r,n,26,1),e.act_iv={},e.act_iv.the_pandemonium_fortress=1===a._readBits(r,n,27,1),e.act_iv.city_of_the_damned=1===a._readBits(r,n,28,1),e.act_iv.river_of_flame=1===a._readBits(r,n,29,1),e.act_v={},e.act_v.harrogath=1===a._readBits(r,n,30,1),e.act_v.frigid_highlands=1===a._readBits(r,n,31,1),e.act_v.arreat_plateau=1===a._readBits(r,n,32,1),e.act_v.crystalline_passage=1===a._readBits(r,n,33,1),e.act_v.halls_of_pain=1===a._readBits(r,n,34,1),e.act_v.glacial_trail=1===a._readBits(r,n,35,1),e.act_v.frozen_tundra=1===a._readBits(r,n,36,1),e.act_v.the_ancients_way=1===a._readBits(r,n,37,1),e.act_v.worldstone_keep_lvl_2=1===a._readBits(r,n,38,1),r.Skip(17),e}function d(t){var e=new n.BinaryWriter(24).SetLittleEndian().SetLength(24);e.WriteArray(new Uint8Array([2,1]));var r=e.Position();return t?(t.act_i&&(a._writeBits(e,+t.act_i.rogue_encampement,r,0,1),a._writeBits(e,+t.act_i.cold_plains,r,1,1),a._writeBits(e,+t.act_i.stony_field,r,2,1),a._writeBits(e,+t.act_i.dark_woods,r,3,1),a._writeBits(e,+t.act_i.black_marsh,r,4,1),a._writeBits(e,+t.act_i.outer_cloister,r,5,1),a._writeBits(e,+t.act_i.jail_lvl_1,r,6,1),a._writeBits(e,+t.act_i.inner_cloister,r,7,1),a._writeBits(e,+t.act_i.catacombs_lvl_2,r,8,1)),t.act_ii&&(a._writeBits(e,+t.act_ii.lut_gholein,r,9,1),a._writeBits(e,+t.act_ii.sewers_lvl_2,r,10,1),a._writeBits(e,+t.act_ii.dry_hills,r,11,1),a._writeBits(e,+t.act_ii.halls_of_the_dead_lvl_2,r,12,1),a._writeBits(e,+t.act_ii.far_oasis,r,13,1),a._writeBits(e,+t.act_ii.lost_city,r,14,1),a._writeBits(e,+t.act_ii.palace_cellar_lvl_1,r,15,1),a._writeBits(e,+t.act_ii.arcane_sanctuary,r,16,1),a._writeBits(e,+t.act_ii.canyon_of_the_magi,r,17,1)),t.act_iii&&(a._writeBits(e,+t.act_iii.kurast_docks,r,18,1),a._writeBits(e,+t.act_iii.spider_forest,r,19,1),a._writeBits(e,+t.act_iii.great_marsh,r,20,1),a._writeBits(e,+t.act_iii.flayer_jungle,r,21,1),a._writeBits(e,+t.act_iii.lower_kurast,r,22,1),a._writeBits(e,+t.act_iii.kurast_bazaar,r,23,1),a._writeBits(e,+t.act_iii.upper_kurast,r,24,1),a._writeBits(e,+t.act_iii.travincal,r,25,1),a._writeBits(e,+t.act_iii.durance_of_hate_lvl_2,r,26,1)),t.act_iv&&(a._writeBits(e,+t.act_iv.the_pandemonium_fortress,r,27,1),a._writeBits(e,+t.act_iv.city_of_the_damned,r,28,1),a._writeBits(e,+t.act_iv.river_of_flame,r,29,1)),t.act_v&&(a._writeBits(e,+t.act_v.harrogath,r,30,1),a._writeBits(e,+t.act_v.frigid_highlands,r,31,1),a._writeBits(e,+t.act_v.arreat_plateau,r,32,1),a._writeBits(e,+t.act_v.crystalline_passage,r,33,1),a._writeBits(e,+t.act_v.halls_of_pain,r,34,1),a._writeBits(e,+t.act_v.glacial_trail,r,35,1),a._writeBits(e,+t.act_v.frozen_tundra,r,36,1),a._writeBits(e,+t.act_v.the_ancients_way,r,37,1),a._writeBits(e,+t.act_v.worldstone_keep_lvl_2,r,38,1))):e.WriteArray(new Uint8Array([255,255,255,255,127])),e.Seek(r+5),e.WriteArray(new Uint8Array(17)),e.toArray()}e.readHeader=function(t,e,r){var n,o,c,f;t.header.filesize=e.ReadUInt32(),t.header.checksum=e.ReadUInt32().toString(16).padStart(8,"0"),e.Skip(4),t.header.name=e.ReadString(16).replace(/\0/g,""),t.header.status=(n=e.ReadUInt8(),(o={}).hardcore=1==(n>>>2&1),o.died=1==(n>>>3&1),o.expansion=1==(n>>>5&1),o.ladder=1==(n>>>6&1),o),t.header.progression=e.ReadUInt8(),t.header.active_arms=e.ReadUInt16(),t.header.class=r.classes[e.ReadUInt8()].n,e.Skip(2),t.header.level=e.ReadUInt8(),t.header.created=e.ReadUInt32(),t.header.last_played=e.ReadUInt32(),e.Skip(4),t.header.assigned_skills=function(t,e){for(var r=[],n=new i.BinaryReader(t).SetLittleEndian(),a=0;a<16;a++){var s=n.ReadUInt32(),o=e.skills[s];o&&r.push(o.s)}return r}(e.ReadArray(64),r),t.header.left_skill=r.skills[e.ReadUInt32()].s,t.header.right_skill=r.skills[e.ReadUInt32()].s,t.header.left_swap_skill=r.skills[e.ReadUInt32()].s,t.header.right_swap_skill=r.skills[e.ReadUInt32()].s,t.header.menu_appearance=function(t,e){var r={},n=new i.BinaryReader(t).SetLittleEndian(),a=n.ReadArray(16),s=n.ReadArray(16);return r.head={graphic:a[0],tint:s[0]},r.torso={graphic:a[1],tint:s[1]},r.legs={graphic:a[2],tint:s[2]},r.right_arm={graphic:a[3],tint:s[3]},r.left_arm={graphic:a[4],tint:s[4]},r.right_hand={graphic:a[5],tint:s[5]},r.left_hand={graphic:a[6],tint:s[6]},r.shield={graphic:a[7],tint:s[7]},r.special1={graphic:a[8],tint:s[8]},r.special2={graphic:a[9],tint:s[9]},r.special3={graphic:a[10],tint:s[10]},r.special4={graphic:a[11],tint:s[11]},r.special5={graphic:a[12],tint:s[12]},r.special6={graphic:a[13],tint:s[13]},r.special7={graphic:a[14],tint:s[14]},r.special8={graphic:a[15],tint:s[15]},r}(e.ReadArray(32)),t.header.difficulty=(c=e.ReadArray(3),(f={}).Normal=c[0],f.Nightmare=c[1],f.Hell=c[2],f),t.header.map_id=e.ReadUInt32(),e.Skip(2),t.header.dead_merc=e.ReadUInt16(),t.header.merc_id=e.ReadUInt32().toString(16),t.header.merc_name_id=e.ReadUInt16(),t.header.merc_type=e.ReadUInt16(),t.header.merc_experience=e.ReadUInt32(),e.Skip(144),e.Skip(4),e.Skip(4),e.Skip(2),t.header.quests_normal=u(e.ReadArray(96)),t.header.quests_nm=u(e.ReadArray(96)),t.header.quests_hell=u(e.ReadArray(96)),e.Skip(2),e.Skip(4),e.Skip(2),t.header.waypoints=function(t){for(var e={},r=new i.BinaryReader(t).SetLittleEndian(),n=0;n<s.length;n++)e[s[n]]=l(r.ReadArray(24));return e}(e.ReadArray(72)),e.Skip(2),e.Skip(2),t.header.npcs=function(t){for(var e={normal:{},nm:{},hell:{}},r=new i.BinaryReader(t).SetLittleEndian(),n=r.Position(),o=0;o<3;o++)e[s[o]]={warriv_act_ii:{intro:!1,congrats:!1},charsi:{intro:!1,congrats:!1},warriv_act_i:{intro:!1,congrats:!1},kashya:{intro:!1,congrats:!1},akara:{intro:!1,congrats:!1},gheed:{intro:!1,congrats:!1},greiz:{intro:!1,congrats:!1},jerhyn:{intro:!1,congrats:!1},meshif_act_ii:{intro:!1,congrats:!1},geglash:{intro:!1,congrats:!1},lysnader:{intro:!1,congrats:!1},fara:{intro:!1,congrats:!1},drogan:{intro:!1,congrats:!1},alkor:{intro:!1,congrats:!1},hratli:{intro:!1,congrats:!1},ashera:{intro:!1,congrats:!1},cain_act_iii:{intro:!1,congrats:!1},elzix:{intro:!1,congrats:!1},malah:{intro:!1,congrats:!1},anya:{intro:!1,congrats:!1},natalya:{intro:!1,congrats:!1},meshif_act_iii:{intro:!1,congrats:!1},ormus:{intro:!1,congrats:!1},cain_act_v:{intro:!1,congrats:!1},qualkehk:{intro:!1,congrats:!1},nihlathak:{intro:!1,congrats:!1}};for(o=0;o<3;o++){(u=e[s[o]]).warriv_act_ii.intro=1===a._readBits(r,n,0+8*o,1),u.charsi.intro=1===a._readBits(r,n,2+8*o,1),u.warriv_act_i.intro=1===a._readBits(r,n,3+8*o,1),u.kashya.intro=1===a._readBits(r,n,4+8*o,1),u.akara.intro=1===a._readBits(r,n,5+8*o,1),u.gheed.intro=1===a._readBits(r,n,6+8*o,1),u.greiz.intro=1===a._readBits(r,n,8+8*o,1),u.jerhyn.intro=1===a._readBits(r,n,9+8*o,1),u.meshif_act_ii.intro=1===a._readBits(r,n,10+8*o,1),u.geglash.intro=1===a._readBits(r,n,11+8*o,1),u.lysnader.intro=1===a._readBits(r,n,12+8*o,1),u.fara.intro=1===a._readBits(r,n,13+8*o,1),u.drogan.intro=1===a._readBits(r,n,14+8*o,1),u.alkor.intro=1===a._readBits(r,n,16+8*o,1),u.hratli.intro=1===a._readBits(r,n,17+8*o,1),u.ashera.intro=1===a._readBits(r,n,18+8*o,1),u.cain_act_iii.intro=1===a._readBits(r,n,21+8*o,1),u.elzix.intro=1===a._readBits(r,n,23+8*o,1),u.malah.intro=1===a._readBits(r,n,24+8*o,1),u.malah.intro=1===a._readBits(r,n,24+8*o,1),u.anya.intro=1===a._readBits(r,n,25+8*o,1),u.natalya.intro=1===a._readBits(r,n,27+8*o,1),u.meshif_act_iii.intro=1===a._readBits(r,n,28+8*o,1),u.ormus.intro=1===a._readBits(r,n,31+8*o,1),u.cain_act_v.intro=1===a._readBits(r,n,37+8*o,1),u.qualkehk.intro=1===a._readBits(r,n,38+8*o,1),u.nihlathak.intro=1===a._readBits(r,n,39+8*o,1)}n+=24;for(o=0;o<3;o++){var u;(u=e[s[o]]).warriv_act_ii.congrats=1===a._readBits(r,n,0+8*o,1),u.charsi.congrats=1===a._readBits(r,n,2+8*o,1),u.warriv_act_i.congrats=1===a._readBits(r,n,3+8*o,1),u.kashya.congrats=1===a._readBits(r,n,4+8*o,1),u.akara.congrats=1===a._readBits(r,n,5+8*o,1),u.gheed.congrats=1===a._readBits(r,n,6+8*o,1),u.greiz.congrats=1===a._readBits(r,n,8+8*o,1),u.jerhyn.congrats=1===a._readBits(r,n,9+8*o,1),u.meshif_act_ii.congrats=1===a._readBits(r,n,10+8*o,1),u.geglash.congrats=1===a._readBits(r,n,11+8*o,1),u.lysnader.congrats=1===a._readBits(r,n,12+8*o,1),u.fara.congrats=1===a._readBits(r,n,13+8*o,1),u.drogan.congrats=1===a._readBits(r,n,14+8*o,1),u.alkor.congrats=1===a._readBits(r,n,16+8*o,1),u.hratli.congrats=1===a._readBits(r,n,17+8*o,1),u.ashera.congrats=1===a._readBits(r,n,18+8*o,1),u.cain_act_iii.congrats=1===a._readBits(r,n,21+8*o,1),u.elzix.congrats=1===a._readBits(r,n,23+8*o,1),u.malah.congrats=1===a._readBits(r,n,24+8*o,1),u.malah.congrats=1===a._readBits(r,n,24+8*o,1),u.anya.congrats=1===a._readBits(r,n,25+8*o,1),u.natalya.congrats=1===a._readBits(r,n,27+8*o,1),u.meshif_act_iii.congrats=1===a._readBits(r,n,28+8*o,1),u.ormus.congrats=1===a._readBits(r,n,31+8*o,1),u.cain_act_v.congrats=1===a._readBits(r,n,37+8*o,1),u.qualkehk.congrats=1===a._readBits(r,n,38+8*o,1),u.nihlathak.congrats=1===a._readBits(r,n,39+8*o,1)}return e}(e.ReadArray(48))},e.writeHeader=function(t,e,r){var i,u;e.SetLittleEndian().Skip(4).Skip(4).WriteUInt32(t.header.active_arms).WriteString(t.header.name,16).WriteArray((i=t.header.status,u=new Uint8Array(1),u[0]|=i.hardcore?4:0,u[0]|=i.died?8:0,u[0]|=i.expansion?32:0,u[0]|=i.ladder?64:0,u)).WriteUInt8(t.header.progression).WriteArray(new Uint8Array([0,0])).WriteUInt8(function(t,e){return t?e.classes.findIndex(function(e){return e&&e.n==t}):-1}(t.header.class,r)).WriteArray(new Uint8Array([16,30])).WriteUInt8(t.header.level).WriteArray(new Uint8Array([0,0,0,0])).WriteUInt32(t.header.last_played).WriteArray(new Uint8Array([255,255,255,255])).WriteArray(function(t,e){var r=new n.BinaryWriter(64).SetLittleEndian().SetLength(64);t=t||[];for(var i=0;i<16;i++){var a=o(t[i],e);a>0?r.WriteUInt32(a):r.WriteUInt32(65535)}return r.toArray()}(t.header.assigned_skills,r)).WriteUInt32(o(t.header.left_skill,r)).WriteUInt32(o(t.header.right_skill,r)).WriteUInt32(o(t.header.left_swap_skill,r)).WriteUInt32(o(t.header.right_swap_skill,r)).Skip(32).WriteArray(function(t){var e=new n.BinaryWriter(3).SetLittleEndian().SetLength(3);return e.WriteUInt8(t.Normal),e.WriteUInt8(t.Nightmare),e.WriteUInt8(t.Hell),e.toArray()}(t.header.difficulty)).WriteUInt32(t.header.map_id).WriteArray(new Uint8Array([0,0])).WriteUInt16(t.header.dead_merc).WriteUInt32(parseInt(t.header.merc_id,16)).WriteUInt16(t.header.merc_name_id).WriteUInt16(t.header.merc_type).WriteUInt32(t.header.merc_experience).Skip(144).WriteString("Woo!").WriteArray(new Uint8Array([6,0,0,0,42,1])).WriteArray(c(t.header.quests_normal)).WriteArray(c(t.header.quests_nm)).WriteArray(c(t.header.quests_hell)).WriteString("WS").WriteArray(new Uint8Array([1,0,0,0,80,0])).WriteArray(function(t){var e=new n.BinaryWriter(72).SetLittleEndian().SetLength(72);if(t)for(var r=0;r<s.length;r++)e.WriteArray(d(t[s[r]]));return e.toArray()}(t.header.waypoints)).WriteArray(new Uint8Array([1,119])).WriteUInt16(52).WriteArray(function(t){var e=new n.BinaryWriter(48).SetLittleEndian().SetLength(48),r=e.Position();if(t){for(var i=0;i<3;i++){var o=t[s[i]];a._writeBits(e,+o.warriv_act_ii.intro,r,0+8*i,1),a._writeBits(e,+o.charsi.intro,r,2+8*i,1),a._writeBits(e,+o.warriv_act_i.intro,r,3+8*i,1),a._writeBits(e,+o.kashya.intro,r,4+8*i,1),a._writeBits(e,+o.akara.intro,r,5+8*i,1),a._writeBits(e,+o.gheed.intro,r,6+8*i,1),a._writeBits(e,+o.greiz.intro,r,8+8*i,1),a._writeBits(e,+o.jerhyn.intro,r,9+8*i,1),a._writeBits(e,+o.meshif_act_ii.intro,r,10+8*i,1),a._writeBits(e,+o.geglash.intro,r,11+8*i,1),a._writeBits(e,+o.lysnader.intro,r,12+8*i,1),a._writeBits(e,+o.fara.intro,r,13+8*i,1),a._writeBits(e,+o.drogan.intro,r,14+8*i,1),a._writeBits(e,+o.alkor.intro,r,16+8*i,1),a._writeBits(e,+o.hratli.intro,r,17+8*i,1),a._writeBits(e,+o.ashera.intro,r,18+8*i,1),a._writeBits(e,+o.cain_act_iii.intro,r,21+8*i,1),a._writeBits(e,+o.elzix.intro,r,23+8*i,1),a._writeBits(e,+o.malah.intro,r,24+8*i,1),a._writeBits(e,+o.malah.intro,r,24+8*i,1),a._writeBits(e,+o.anya.intro,r,25+8*i,1),a._writeBits(e,+o.natalya.intro,r,27+8*i,1),a._writeBits(e,+o.meshif_act_iii.intro,r,28+8*i,1),a._writeBits(e,+o.ormus.intro,r,31+8*i,1),a._writeBits(e,+o.cain_act_v.intro,r,37+8*i,1),a._writeBits(e,+o.qualkehk.intro,r,38+8*i,1),a._writeBits(e,+o.nihlathak.intro,r,39+8*i,1)}r+=24;for(i=0;i<3;i++){o=t[s[i]];a._writeBits(e,+o.warriv_act_ii.congrats,r,0+8*i,1),a._writeBits(e,+o.charsi.congrats,r,2+8*i,1),a._writeBits(e,+o.warriv_act_i.congrats,r,3+8*i,1),a._writeBits(e,+o.kashya.congrats,r,4+8*i,1),a._writeBits(e,+o.akara.congrats,r,5+8*i,1),a._writeBits(e,+o.gheed.congrats,r,6+8*i,1),a._writeBits(e,+o.greiz.congrats,r,8+8*i,1),a._writeBits(e,+o.jerhyn.congrats,r,9+8*i,1),a._writeBits(e,+o.meshif_act_ii.congrats,r,10+8*i,1),a._writeBits(e,+o.geglash.congrats,r,11+8*i,1),a._writeBits(e,+o.lysnader.congrats,r,12+8*i,1),a._writeBits(e,+o.fara.congrats,r,13+8*i,1),a._writeBits(e,+o.drogan.congrats,r,14+8*i,1),a._writeBits(e,+o.alkor.congrats,r,16+8*i,1),a._writeBits(e,+o.hratli.congrats,r,17+8*i,1),a._writeBits(e,+o.ashera.congrats,r,18+8*i,1),a._writeBits(e,+o.cain_act_iii.congrats,r,21+8*i,1),a._writeBits(e,+o.elzix.congrats,r,23+8*i,1),a._writeBits(e,+o.malah.congrats,r,24+8*i,1),a._writeBits(e,+o.malah.congrats,r,24+8*i,1),a._writeBits(e,+o.anya.congrats,r,25+8*i,1),a._writeBits(e,+o.natalya.congrats,r,27+8*i,1),a._writeBits(e,+o.meshif_act_iii.congrats,r,28+8*i,1),a._writeBits(e,+o.ormus.congrats,r,31+8*i,1),a._writeBits(e,+o.cain_act_v.congrats,r,37+8*i,1),a._writeBits(e,+o.qualkehk.congrats,r,38+8*i,1),a._writeBits(e,+o.nihlathak.congrats,r,39+8*i,1)}}return e.toArray()}(t.header.npcs))}},function(t,e,r){"use strict";function i(t){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}Object.defineProperty(e,"__esModule",{value:!0}),i(r(7)),i(r(18));var n=r(19);e.types=n.default},function(t,e,r){"use strict";var i=this&&this.__awaiter||function(t,e,r,i){return new(r||(r=Promise))(function(n,a){function s(t){try{u(i.next(t))}catch(t){a(t)}}function o(t){try{u(i.throw(t))}catch(t){a(t)}}function u(t){t.done?n(t.value):new r(function(e){e(t.value)}).then(s,o)}u((i=i.apply(t,e||[])).next())})},n=this&&this.__generator||function(t,e){var r,i,n,a,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){s.label=a[1];break}if(6===a[0]&&s.label<n[1]){s.label=n[1],n=a;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(a);break}n[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}};Object.defineProperty(e,"__esModule",{value:!0});var a=r(8),s=r(14),o=r(1),u=r(0),c=r(15),f=r(16),h=r(17),l={extendedStash:!1};e.read=function(t,e,r){return i(this,void 0,void 0,function(){var i,u,d;return n(this,function(n){switch(n.label){case 0:return i={},u=new o.BinaryReader(t).SetLittleEndian(),d=Object.assign(l,r),[4,a.readHeader(i,u)];case 1:return n.sent(),[4,a.readHeaderData(i,u,e)];case 2:return n.sent(),[4,s.readAttributes(i,u,e)];case 3:return n.sent(),[4,c.readSkills(i,u,e)];case 4:return n.sent(),[4,f.readCharItems(i,u,e,d)];case 5:return n.sent(),[4,f.readCorpseItems(i,u,e,d)];case 6:return n.sent(),i.header.status.expansion?[4,f.readMercItems(i,u,e,d)]:[3,9];case 7:return n.sent(),[4,f.readGolemItems(i,u,e,d)];case 8:n.sent(),n.label=9;case 9:return[4,h.enhanceAttributes(i,e)];case 10:return n.sent(),[2,i]}})})},e.write=function(t,e,r){return i(this,void 0,void 0,function(){var i,o,h,d,_,p,g,m,v,y,w,B,b,A,k,E,x,S;return n(this,function(n){switch(n.label){case 0:return i=Object.assign(l,r),o=(new u.BinaryWriter).SetLittleEndian(),d=(h=o).WriteArray,[4,a.writeHeader(t)];case 1:return d.apply(h,[n.sent()]),p=(_=o).WriteArray,[4,a.writeHeaderData(t,e)];case 2:return p.apply(_,[n.sent()]),m=(g=o).WriteArray,[4,s.writeAttributes(t,e)];case 3:return m.apply(g,[n.sent()]),y=(v=o).WriteArray,[4,c.writeSkills(t,e)];case 4:return y.apply(v,[n.sent()]),B=(w=o).WriteArray,[4,f.writeCharItems(t,e,i)];case 5:return B.apply(w,[n.sent()]),A=(b=o).WriteArray,[4,f.writeCorpseItem(t,e,i)];case 6:return A.apply(b,[n.sent()]),t.header.status.expansion?(E=(k=o).WriteArray,[4,f.writeMercItems(t,e,i)]):[3,9];case 7:return E.apply(k,[n.sent()]),S=(x=o).WriteArray,[4,f.writeGolemItems(t,e,i)];case 8:S.apply(x,[n.sent()]),n.label=9;case 9:return[4,a.fixHeader(o)];case 10:return n.sent(),[2,o.toArray()]}})})}},function(t,e,r){"use strict";var i=this&&this.__awaiter||function(t,e,r,i){return new(r||(r=Promise))(function(n,a){function s(t){try{u(i.next(t))}catch(t){a(t)}}function o(t){try{u(i.throw(t))}catch(t){a(t)}}function u(t){t.done?n(t.value):new r(function(e){e(t.value)}).then(s,o)}u((i=i.apply(t,e||[])).next())})},n=this&&this.__generator||function(t,e){var r,i,n,a,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){s.label=a[1];break}if(6===a[0]&&s.label<n[1]){s.label=n[1],n=a;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(a);break}n[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}},a=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var s=r(0);function o(t){return i(this,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:switch(t){case 96:return[3,1]}return[3,3];case 1:return[4,Promise.resolve().then(function(){return a(r(5))})];case 2:return[2,e.sent()];case 3:return[4,Promise.resolve().then(function(){return a(r(5))})];case 4:return[2,e.sent()]}})})}e.readHeader=function(t,e){return i(this,void 0,void 0,function(){return n(this,function(r){if(t.header={},t.header.identifier=e.ReadUInt32().toString(16).padStart(8,"0"),"aa55aa55"!=t.header.identifier)throw new Error("D2S identifier 'aa55aa55' not found at position "+(e.Position()-4));return t.header.version=e.ReadUInt32(),[2]})})},e.readHeaderData=function(t,e,r){return i(this,void 0,void 0,function(){var i;return n(this,function(n){switch(n.label){case 0:return[4,o(t.header.version)];case 1:if(null==(i=n.sent()))throw new Error("Cannot parse version: "+t.header.version);return i.readHeader(t,e,r),[2]}})})},e.writeHeader=function(t){return i(this,void 0,void 0,function(){var e;return n(this,function(r){return(e=new s.BinaryWriter).SetLittleEndian().WriteUInt32(parseInt(t.header.identifier,16)).WriteUInt32(t.header.version),[2,e.toArray()]})})},e.writeHeaderData=function(t,e){return i(this,void 0,void 0,function(){var r,i;return n(this,function(n){switch(n.label){case 0:return r=new s.BinaryWriter,[4,o(t.header.version)];case 1:if(null==(i=n.sent()))throw new Error("Cannot parse version: "+t.header.version);return i.writeHeader(t,r,e),[2,r.toArray()]}})})},e.fixHeader=function(t){return i(this,void 0,void 0,function(){var e,r,i,a;return n(this,function(n){for(e=0,r=t.Length(),t.Seek(8).WriteUInt32(r),t.Seek(12).WriteUInt32(0),i=0;i<r;i++)a=t.Seek(i).Peek(),2147483648&e&&(a+=1),e=a+2*e,e>>>=0;return t.Seek(12).WriteUInt32(e),[2]})})}},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";e.byteLength=function(t){var e=c(t),r=e[0],i=e[1];return 3*(r+i)/4-i},e.toByteArray=function(t){var e,r,i=c(t),s=i[0],o=i[1],u=new a(function(t,e,r){return 3*(e+r)/4-r}(0,s,o)),f=0,h=o>0?s-4:s;for(r=0;r<h;r+=4)e=n[t.charCodeAt(r)]<<18|n[t.charCodeAt(r+1)]<<12|n[t.charCodeAt(r+2)]<<6|n[t.charCodeAt(r+3)],u[f++]=e>>16&255,u[f++]=e>>8&255,u[f++]=255&e;2===o&&(e=n[t.charCodeAt(r)]<<2|n[t.charCodeAt(r+1)]>>4,u[f++]=255&e);1===o&&(e=n[t.charCodeAt(r)]<<10|n[t.charCodeAt(r+1)]<<4|n[t.charCodeAt(r+2)]>>2,u[f++]=e>>8&255,u[f++]=255&e);return u},e.fromByteArray=function(t){for(var e,r=t.length,n=r%3,a=[],s=0,o=r-n;s<o;s+=16383)a.push(f(t,s,s+16383>o?o:s+16383));1===n?(e=t[r-1],a.push(i[e>>2]+i[e<<4&63]+"==")):2===n&&(e=(t[r-2]<<8)+t[r-1],a.push(i[e>>10]+i[e>>4&63]+i[e<<2&63]+"="));return a.join("")};for(var i=[],n=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,u=s.length;o<u;++o)i[o]=s[o],n[s.charCodeAt(o)]=o;function c(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function f(t,e,r){for(var n,a,s=[],o=e;o<r;o+=3)n=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]),s.push(i[(a=n)>>18&63]+i[a>>12&63]+i[a>>6&63]+i[63&a]);return s.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,r,i,n){var a,s,o=8*n-i-1,u=(1<<o)-1,c=u>>1,f=-7,h=r?n-1:0,l=r?-1:1,d=t[e+h];for(h+=l,a=d&(1<<-f)-1,d>>=-f,f+=o;f>0;a=256*a+t[e+h],h+=l,f-=8);for(s=a&(1<<-f)-1,a>>=-f,f+=i;f>0;s=256*s+t[e+h],h+=l,f-=8);if(0===a)a=1-c;else{if(a===u)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,i),a-=c}return(d?-1:1)*s*Math.pow(2,a-i)},e.write=function(t,e,r,i,n,a){var s,o,u,c=8*a-n-1,f=(1<<c)-1,h=f>>1,l=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:a-1,_=i?1:-1,p=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,s=f):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),(e+=s+h>=1?l/u:l*Math.pow(2,1-h))*u>=2&&(s++,u/=2),s+h>=f?(o=0,s=f):s+h>=1?(o=(e*u-1)*Math.pow(2,n),s+=h):(o=e*Math.pow(2,h-1)*Math.pow(2,n),s=0));n>=8;t[r+d]=255&o,d+=_,o/=256,n-=8);for(s=s<<n|o,c+=n;c>0;t[r+d]=255&s,d+=_,s/=256,c-=8);t[r+d-_]|=128*p}},function(t,e){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},function(t,e){t.exports=i;var r=null;try{r=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function i(t,e,r){this.low=0|t,this.high=0|e,this.unsigned=!!r}function n(t){return!0===(t&&t.__isLong__)}i.prototype.__isLong__,Object.defineProperty(i.prototype,"__isLong__",{value:!0}),i.isLong=n;var a={},s={};function o(t,e){var r,i,n;return e?(n=0<=(t>>>=0)&&t<256)&&(i=s[t])?i:(r=c(t,(0|t)<0?-1:0,!0),n&&(s[t]=r),r):(n=-128<=(t|=0)&&t<128)&&(i=a[t])?i:(r=c(t,t<0?-1:0,!1),n&&(a[t]=r),r)}function u(t,e){if(isNaN(t))return e?v:m;if(e){if(t<0)return v;if(t>=_)return A}else{if(t<=-p)return k;if(t+1>=p)return b}return t<0?u(-t,e).neg():c(t%d|0,t/d|0,e)}function c(t,e,r){return new i(t,e,r)}i.fromInt=o,i.fromNumber=u,i.fromBits=c;var f=Math.pow;function h(t,e,r){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return m;if("number"==typeof e?(r=e,e=!1):e=!!e,(r=r||10)<2||36<r)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return h(t.substring(1),e,r).neg();for(var n=u(f(r,8)),a=m,s=0;s<t.length;s+=8){var o=Math.min(8,t.length-s),c=parseInt(t.substring(s,s+o),r);if(o<8){var l=u(f(r,o));a=a.mul(l).add(u(c))}else a=(a=a.mul(n)).add(u(c))}return a.unsigned=e,a}function l(t,e){return"number"==typeof t?u(t,e):"string"==typeof t?h(t,e):c(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}i.fromString=h,i.fromValue=l;var d=4294967296,_=d*d,p=_/2,g=o(1<<24),m=o(0);i.ZERO=m;var v=o(0,!0);i.UZERO=v;var y=o(1);i.ONE=y;var w=o(1,!0);i.UONE=w;var B=o(-1);i.NEG_ONE=B;var b=c(-1,2147483647,!1);i.MAX_VALUE=b;var A=c(-1,-1,!0);i.MAX_UNSIGNED_VALUE=A;var k=c(0,-2147483648,!1);i.MIN_VALUE=k;var E=i.prototype;E.toInt=function(){return this.unsigned?this.low>>>0:this.low},E.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},E.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(k)){var e=u(t),r=this.div(e),i=r.mul(e).sub(this);return r.toString(t)+i.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var n=u(f(t,6),this.unsigned),a=this,s="";;){var o=a.div(n),c=(a.sub(o.mul(n)).toInt()>>>0).toString(t);if((a=o).isZero())return c+s;for(;c.length<6;)c="0"+c;s=""+c+s}},E.getHighBits=function(){return this.high},E.getHighBitsUnsigned=function(){return this.high>>>0},E.getLowBits=function(){return this.low},E.getLowBitsUnsigned=function(){return this.low>>>0},E.getNumBitsAbs=function(){if(this.isNegative())return this.eq(k)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},E.isZero=function(){return 0===this.high&&0===this.low},E.eqz=E.isZero,E.isNegative=function(){return!this.unsigned&&this.high<0},E.isPositive=function(){return this.unsigned||this.high>=0},E.isOdd=function(){return 1==(1&this.low)},E.isEven=function(){return 0==(1&this.low)},E.equals=function(t){return n(t)||(t=l(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},E.eq=E.equals,E.notEquals=function(t){return!this.eq(t)},E.neq=E.notEquals,E.ne=E.notEquals,E.lessThan=function(t){return this.comp(t)<0},E.lt=E.lessThan,E.lessThanOrEqual=function(t){return this.comp(t)<=0},E.lte=E.lessThanOrEqual,E.le=E.lessThanOrEqual,E.greaterThan=function(t){return this.comp(t)>0},E.gt=E.greaterThan,E.greaterThanOrEqual=function(t){return this.comp(t)>=0},E.gte=E.greaterThanOrEqual,E.ge=E.greaterThanOrEqual,E.compare=function(t){if(n(t)||(t=l(t)),this.eq(t))return 0;var e=this.isNegative(),r=t.isNegative();return e&&!r?-1:!e&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},E.comp=E.compare,E.negate=function(){return!this.unsigned&&this.eq(k)?k:this.not().add(y)},E.neg=E.negate,E.add=function(t){n(t)||(t=l(t));var e=this.high>>>16,r=65535&this.high,i=this.low>>>16,a=65535&this.low,s=t.high>>>16,o=65535&t.high,u=t.low>>>16,f=0,h=0,d=0,_=0;return d+=(_+=a+(65535&t.low))>>>16,h+=(d+=i+u)>>>16,f+=(h+=r+o)>>>16,f+=e+s,c((d&=65535)<<16|(_&=65535),(f&=65535)<<16|(h&=65535),this.unsigned)},E.subtract=function(t){return n(t)||(t=l(t)),this.add(t.neg())},E.sub=E.subtract,E.multiply=function(t){if(this.isZero())return m;if(n(t)||(t=l(t)),r)return c(r.mul(this.low,this.high,t.low,t.high),r.get_high(),this.unsigned);if(t.isZero())return m;if(this.eq(k))return t.isOdd()?k:m;if(t.eq(k))return this.isOdd()?k:m;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(g)&&t.lt(g))return u(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,i=65535&this.high,a=this.low>>>16,s=65535&this.low,o=t.high>>>16,f=65535&t.high,h=t.low>>>16,d=65535&t.low,_=0,p=0,v=0,y=0;return v+=(y+=s*d)>>>16,p+=(v+=a*d)>>>16,v&=65535,p+=(v+=s*h)>>>16,_+=(p+=i*d)>>>16,p&=65535,_+=(p+=a*h)>>>16,p&=65535,_+=(p+=s*f)>>>16,_+=e*d+i*h+a*f+s*o,c((v&=65535)<<16|(y&=65535),(_&=65535)<<16|(p&=65535),this.unsigned)},E.mul=E.multiply,E.divide=function(t){if(n(t)||(t=l(t)),t.isZero())throw Error("division by zero");var e,i,a;if(r)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?c((this.unsigned?r.div_u:r.div_s)(this.low,this.high,t.low,t.high),r.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?v:m;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return v;if(t.gt(this.shru(1)))return w;a=v}else{if(this.eq(k))return t.eq(y)||t.eq(B)?k:t.eq(k)?y:(e=this.shr(1).div(t).shl(1)).eq(m)?t.isNegative()?y:B:(i=this.sub(t.mul(e)),a=e.add(i.div(t)));if(t.eq(k))return this.unsigned?v:m;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();a=m}for(i=this;i.gte(t);){e=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var s=Math.ceil(Math.log(e)/Math.LN2),o=s<=48?1:f(2,s-48),h=u(e),d=h.mul(t);d.isNegative()||d.gt(i);)d=(h=u(e-=o,this.unsigned)).mul(t);h.isZero()&&(h=y),a=a.add(h),i=i.sub(d)}return a},E.div=E.divide,E.modulo=function(t){return n(t)||(t=l(t)),r?c((this.unsigned?r.rem_u:r.rem_s)(this.low,this.high,t.low,t.high),r.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},E.mod=E.modulo,E.rem=E.modulo,E.not=function(){return c(~this.low,~this.high,this.unsigned)},E.and=function(t){return n(t)||(t=l(t)),c(this.low&t.low,this.high&t.high,this.unsigned)},E.or=function(t){return n(t)||(t=l(t)),c(this.low|t.low,this.high|t.high,this.unsigned)},E.xor=function(t){return n(t)||(t=l(t)),c(this.low^t.low,this.high^t.high,this.unsigned)},E.shiftLeft=function(t){return n(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?c(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):c(0,this.low<<t-32,this.unsigned)},E.shl=E.shiftLeft,E.shiftRight=function(t){return n(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?c(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):c(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},E.shr=E.shiftRight,E.shiftRightUnsigned=function(t){if(n(t)&&(t=t.toInt()),0===(t&=63))return this;var e=this.high;return t<32?c(this.low>>>t|e<<32-t,e>>>t,this.unsigned):c(32===t?e:e>>>t-32,0,this.unsigned)},E.shru=E.shiftRightUnsigned,E.shr_u=E.shiftRightUnsigned,E.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},E.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},E.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},E.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},E.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},i.fromBytes=function(t,e,r){return r?i.fromBytesLE(t,e):i.fromBytesBE(t,e)},i.fromBytesLE=function(t,e){return new i(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},i.fromBytesBE=function(t,e){return new i(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)}},function(t,e,r){"use strict";var i=this&&this.__awaiter||function(t,e,r,i){return new(r||(r=Promise))(function(n,a){function s(t){try{u(i.next(t))}catch(t){a(t)}}function o(t){try{u(i.throw(t))}catch(t){a(t)}}function u(t){t.done?n(t.value):new r(function(e){e(t.value)}).then(s,o)}u((i=i.apply(t,e||[])).next())})},n=this&&this.__generator||function(t,e){var r,i,n,a,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){s.label=a[1];break}if(6===a[0]&&s.label<n[1]){s.label=n[1],n=a;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(a);break}n[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}};Object.defineProperty(e,"__esModule",{value:!0});var a=r(2),s=r(0);e.readAttributes=function(t,e,r){return i(this,void 0,void 0,function(){var i,s,u,c,f;return n(this,function(n){if(t.attributes={},"gf"!=e.ReadString(2))throw new Error("Item header 'gf' not found at position "+(e.Position()-2));for(i=e.Position(),s=0,u=a._readBits(e,i,s,9);511!=u;){if(s+=9,void 0===(c=r.magical_properties[u]))throw new Error("Invalid attribute id: "+u);f=c.cB,t.attributes[o[c.s]]=a._readBits(e,i,s,f),u>=6&&u<=11&&(t.attributes[o[c.s]]>>>=8),s+=f,u=a._readBits(e,i,s,9)}return[2]})})},e.writeAttributes=function(t,e){return i(this,void 0,void 0,function(){var r,i,u,c,f,h,l;return n(this,function(n){for((r=(new s.BinaryWriter).SetLittleEndian()).WriteString("gf"),i=r.Position(),u=0,c=0;c<16;c++){if(void 0===(f=e.magical_properties[c]))throw new Error("Invalid attribute: "+f);h=t.attributes[o[f.s]],l=f.cB,c>=6&&c<=11&&(h<<=8),a._writeBits(r,c,i,u,9),u+=9,a._writeBits(r,h,i,u,l),u+=l}return a._writeBits(r,511,i,u,9),[2,r.toArray()]})})};var o={strength:"strength",energy:"energy",dexterity:"dexterity",vitality:"vitality",statpts:"unused_stats",newskills:"unused_skill_points",hitpoints:"current_hp",maxhp:"max_hp",mana:"current_mana",maxmana:"max_mana",stamina:"current_stamina",maxstamina:"max_stamina",level:"level",experience:"experience",gold:"gold",goldbank:"stashed_gold"}},function(t,e,r){"use strict";var i=this&&this.__awaiter||function(t,e,r,i){return new(r||(r=Promise))(function(n,a){function s(t){try{u(i.next(t))}catch(t){a(t)}}function o(t){try{u(i.throw(t))}catch(t){a(t)}}function u(t){t.done?n(t.value):new r(function(e){e(t.value)}).then(s,o)}u((i=i.apply(t,e||[])).next())})},n=this&&this.__generator||function(t,e){var r,i,n,a,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){s.label=a[1];break}if(6===a[0]&&s.label<n[1]){s.label=n[1],n=a;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(a);break}n[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}};Object.defineProperty(e,"__esModule",{value:!0});var a=r(0);e.readSkills=function(t,e,r){return i(this,void 0,void 0,function(){var i,a,o;return n(this,function(n){if(t.skills=[],i=s[t.header.class],"if"!==e.ReadString(2))throw new Error("Skills header 'if' not found at position "+(e.Position()-2));for(a=0;a<30;a++)o=i+a,t.skills.push({id:o,points:e.ReadUInt8(),name:r.skills[o].s});return[2]})})},e.writeSkills=function(t,e){return i(this,void 0,void 0,function(){var e,r;return n(this,function(i){for((e=(new a.BinaryWriter).SetLittleEndian()).WriteString("if"),r=0;r<30;r++)e.WriteUInt8(t.skills[r].points);return[2,e.toArray()]})})};var s={Amazon:6,Sorceress:36,Necromancer:66,Paladin:96,Barbarian:126,Druid:221,Assassin:251}},function(t,e,r){"use strict";var i=this&&this.__awaiter||function(t,e,r,i){return new(r||(r=Promise))(function(n,a){function s(t){try{u(i.next(t))}catch(t){a(t)}}function o(t){try{u(i.throw(t))}catch(t){a(t)}}function u(t){t.done?n(t.value):new r(function(e){e(t.value)}).then(s,o)}u((i=i.apply(t,e||[])).next())})},n=this&&this.__generator||function(t,e){var r,i,n,a,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){s.label=a[1];break}if(6===a[0]&&s.label<n[1]){s.label=n[1],n=a;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(a);break}n[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}};Object.defineProperty(e,"__esModule",{value:!0});var a,s,o=r(1),u=r(0),c=r(2);function f(t,e,r){var i=[];if("JM"!==t.ReadString(2))throw new Error("Item list header 'JM' not found at position "+(t.Position()-2));for(var n=t.ReadUInt16(),a=0;a<n;a++)i.push(l(t,e,r));return i}function h(t,e,r){var i=(new u.BinaryWriter).SetLittleEndian();i.WriteString("JM"),i.WriteUInt16(t.length);for(var n=0;n<t.length;n++)i.WriteArray(d(t[n],e,r));return i.toArray()}function l(t,e,r,i){var n=t.Position(),u=function(t,e,r){var i={},n=t.Position();if("JM"!==t.ReadString(2))throw new Error("Item header 'JM' not found at position "+(t.Position()-2));if(i.identified=c._readBits(t,n,20,1),i.socketed=c._readBits(t,n,27,1),i.new=c._readBits(t,n,29,1),i.is_ear=c._readBits(t,n,32,1),i.starter_item=c._readBits(t,n,33,1),i.simple_item=c._readBits(t,n,37,1),i.ethereal=c._readBits(t,n,38,1),i.personalized=c._readBits(t,n,40,1),i.given_runeword=c._readBits(t,n,42,1),i.location_id=c._readBits(t,n,58,3),i.equipped_id=c._readBits(t,n,61,4),i.position_x=c._readBits(t,n,65,4),i.position_y=c._readBits(t,n,69,r.extendedStash?4:3),i.alt_position_id=c._readBits(t,n,73,3),i.is_ear){for(var s=c._readBits(t,n,76,3),u=c._readBits(t,n,79,7),f=86,h=new Uint8Array(15),l=0;l<h.length&&(h[l]=c._readBits(t,n,f,7),f+=7,0!==h[l]);l++);var d=new o.BinaryReader(h).SetLittleEndian().ReadString(15).trim().replace(/\0/g,"");i.ear_attributes={class:s,level:u,name:d}}else{for(h=new Uint8Array(4),l=0;l<h.length;l++)h[l]=c._readBits(t,n,76+8*l,8);if(i.type=new o.BinaryReader(h).SetLittleEndian().ReadString(4).trim().replace(/\0/g,""),e.armor_items[i.type]){i.type_id=a.Armor;var _=e.armor_items[i.type];i.type_name=_.n}else if(e.weapon_items[i.type]){i.type_id=a.Weapon;_=e.weapon_items[i.type];i.type_name=_.n}else e.other_items[i.type]&&(i.type_id=a.Other,i.type_name=e.other_items[i.type].n);i.nr_of_items_in_sockets=c._readBits(t,n,108,3),t.Seek(n+14)}return i}(t,e,r);if(!u.simple_item){u.id=c._readBits(t,n,111,32),u.level=c._readBits(t,n,143,7),u.quality=c._readBits(t,n,150,4),u.multiple_pictures=c._readBits(t,n,154,1);var f=155;switch(u.multiple_pictures&&(u.picture_id=c._readBits(t,n,f,3),f+=3),u.class_specific=c._readBits(t,n,f,1),f+=1,u.class_specific&&(f+=11),u.quality){case s.Low:u.low_quality_id=c._readBits(t,n,f,3),f+=3;break;case s.Normal:break;case s.Superior:f+=3;break;case s.Magic:u.magic_prefix=c._readBits(t,n,f,11),u.magic_prefix&&(u.magic_prefix_name=e.magic_prefixes[u.magic_prefix]?e.magic_prefixes[u.magic_prefix].n:null),f+=11,u.magic_suffix=c._readBits(t,n,f,11),u.magic_suffix&&(u.magic_suffix_name=e.magic_suffixes[u.magic_suffix]?e.magic_suffixes[u.magic_suffix].n:null),f+=11;break;case s.Set:u.set_id=c._readBits(t,n,f,12),u.set_name=e.set_items[u.set_id]?e.set_items[u.set_id].n:null,f+=12;break;case s.Unique:u.unique_id=c._readBits(t,n,f,12),u.unique_name=e.unq_items[u.unique_id]?e.unq_items[u.unique_id].n:null,f+=12;break;case s.Rare:case s.Crafted:var h=c._readBits(t,n,f,8);f+=8,h&&(u.rare_name=e.rare_names[h]?e.rare_names[h].n:null);var d=c._readBits(t,n,f,8);f+=8,d&&(u.rare_name2=e.rare_names[d]?e.rare_names[d].n:null),u.magical_name_ids=[];for(var _=0;_<6;_++){var g=c._readBits(t,n,f,1);f++,1===g?(u.magical_name_ids[_]=c._readBits(t,n,f,11),f+=11):u.magical_name_ids[_]=null}}if(u.given_runeword&&(u.runeword_id=c._readBits(t,n,f,12),f+=12,u.runeword_name=e.runewords[u.runeword_id].n,f+=4),u.personalized){var m=new Uint8Array(15);for(_=0;_<m.length&&(m[_]=c._readBits(t,n,f,7),f+=7,0!==m[_]);_++);u.personalized_name=new o.BinaryReader(m).SetLittleEndian().ReadString(15).trim().replace(/\0/g,"")}"tbk"!==u.type&&"ibk"!=u.type||(f+=5),u.timestamp=c._readBits(t,n,f,1),f+=1,u.type_id===a.Armor&&(u.defense_rating=c._readBits(t,n,f,11)-10,f+=11),u.type_id!==a.Armor&&u.type_id!==a.Weapon||(u.max_durability=c._readBits(t,n,f,8),f+=8,u.max_durability>0&&(u.current_durability=c._readBits(t,n,f,8),f+=8,f+=1)),e.stackables[u.type]&&(u.quantity=c._readBits(t,n,f,9),f+=9),1===u.socketed&&(u.total_nr_of_sockets=c._readBits(t,n,f,4),f+=4);var v=0;u.quality===s.Set&&(v=c._readBits(t,n,f,5),u.set_list_count=0,f+=5);var y=p(t,n,f,e);for(f=y.offset,y.magic_attributes&&y.magic_attributes.length>0&&(u.magic_attributes=y.magic_attributes);v>0;){if(1&v){u.set_list_count+=1;var w=p(t,n,f,e);f=w.offset,u.set_attributes?u.set_attributes.push(w.magic_attributes):u.set_attributes=[w.magic_attributes]}v>>>=1}if(1===u.given_runeword){var B=p(t,n,f,e);f=B.offset,B.magic_attributes&&B.magic_attributes.length>0&&(u.runeword_attributes=B.magic_attributes)}t.Seek(n+Math.ceil(f/8))}if(u.nr_of_items_in_sockets>0&&0===u.simple_item){u.socketed_items=[];for(_=0;_<u.nr_of_items_in_sockets;_++)u.socketed_items.push(l(t,e,r,u))}return u}function d(t,e,r){var i=new u.BinaryWriter(14).SetLittleEndian(),n=i.Position();if(function(t,e,r,i){var n=t.Position();if(t.WriteString("JM"),c._writeBits(t,e.identified,n,20,1),c._writeBits(t,e.socketed,n,27,1),c._writeBits(t,e.new,n,29,1),c._writeBits(t,e.is_ear,n,32,1),c._writeBits(t,e.starter_item,n,33,1),c._writeBits(t,e.simple_item,n,37,1),c._writeBits(t,e.ethereal,n,38,1),c._writeBits(t,e.personalized,n,40,1),c._writeBits(t,e.given_runeword,n,42,1),c._writeBits(t,e.location_id,n,58,3),c._writeBits(t,e.equipped_id,n,61,4),c._writeBits(t,e.position_x,n,65,4),c._writeBits(t,e.position_y,n,69,i.extendedStash?4:3),c._writeBits(t,e.alt_position_id,n,73,3),e.is_ear){c._writeBits(t,e.ear_attributes.class,n,76,3),c._writeBits(t,e.ear_attributes.level,n,79,7);for(var a=86,s=e.ear_attributes.name.substring(0,15),o=0;o<s.length;o++)c._writeBits(t,127&s.charCodeAt(o),n,a,7),a+=7;c._writeBits(t,0,n,a,7)}else{var f=new u.BinaryWriter(4).SetLittleEndian().WriteString(e.type.padEnd(4," ")).toArray();c._writeBits(t,f,n,76,4),c._writeBits(t,e.nr_of_items_in_sockets,n,108,3),t.SetLength(n+14)}}(i,t,0,r),!t.simple_item){c._writeBits(i,t.id,n,111,32),c._writeBits(i,t.level,n,143,7),c._writeBits(i,t.quality,n,150,4),c._writeBits(i,t.multiple_pictures,n,154,1);var o=155;switch(t.multiple_pictures&&(c._writeBits(i,t.picture_id,n,o,3),o+=3),c._writeBits(i,t.class_specific,n,o,1),o+=1,t.class_specific&&(o+=11),t.quality){case s.Low:c._writeBits(i,t.low_quality_id,n,o,3),o+=3;break;case s.Normal:break;case s.Superior:o+=3;break;case s.Magic:c._writeBits(i,t.magic_prefix,n,o,11),o+=11,c._writeBits(i,t.magic_suffix,n,o,11),o+=11;break;case s.Set:c._writeBits(i,t.set_id,n,o,12),o+=12;break;case s.Unique:c._writeBits(i,t.unique_id,n,o,12),o+=12;break;case s.Rare:case s.Crafted:c._writeBits(i,_(t.rare_name,e),n,o,8),o+=8,c._writeBits(i,_(t.rare_name2,e),n,o,8),o+=8,t.magical_name_ids=[];for(var f=0;f<6;f++){var h=t.magical_name_ids[f];h?(c._writeBits(i,1,n,o,1),o++,c._writeBits(i,h,n,o,11),o+=11):(c._writeBits(i,0,n,o,1),o++)}}if(t.given_runeword&&(c._writeBits(i,t.runeword_id,n,o,12),o+=12,c._writeBits(i,5,n,o,4),o+=4),t.personalized){var l=t.personalized_name.substring(0,15);for(f=0;f<l.length;f++)c._writeBits(i,127&l.charCodeAt(f),n,o,7),o+=7;c._writeBits(i,0,n,o,7),o+=7}if("tbk"!==t.type&&"ibk"!==t.type||("ibk"===t.type&&c._writeBits(i,1,n,o,5),o+=5),c._writeBits(i,t.timestamp,n,o,1),o+=1,t.type_id!==a.Armor&&t.type_id!==a.Shield||(c._writeBits(i,t.defense_rating+10,n,o,11),o+=11),t.type_id!==a.Armor&&t.type_id!==a.Shield&&t.type_id!==a.Weapon||(c._writeBits(i,t.max_durability||0,n,o,8),o+=8,t.max_durability>0&&(c._writeBits(i,t.current_durability,n,o,8),o+=8,o+=1)),e.stackables[t.type]&&(c._writeBits(i,t.quantity,n,o,9),o+=9),1===t.socketed&&(c._writeBits(i,t.total_nr_of_sockets,n,o,4),o+=4),t.quality===s.Set){var p=(1<<(null!=t.set_attributes?t.set_attributes.length:0))-1;c._writeBits(i,p,n,o,5),o+=5}if(o=g(i,t.magic_attributes,n,o,e),t.set_attributes&&t.set_attributes.length>0)for(f=0;f<t.set_attributes.length;f++)o=g(i,t.set_attributes[f],n,o,e);1===t.given_runeword&&(o=g(i,t.runeword_attributes,n,o,e));var m=n+Math.ceil(o/8);i.SetLength(m).Seek(m)}if(t.nr_of_items_in_sockets>0&&0===t.simple_item)for(f=0;f<t.nr_of_items_in_sockets;f++)i.WriteArray(d(t.socketed_items[f],e,r));return i.toArray()}function _(t,e){return e.rare_names.findIndex(function(e){return e&&(e.n.toLowerCase().startsWith(t.toLowerCase())||t.toLowerCase().startsWith(e.n.toLowerCase()))})}function p(t,e,r,i){var n=c._readBits(t,e,r,9);r+=9;for(var a=[];511!=n;){for(var s=[],o=i.magical_properties[n].np||1,u=0;u<o;u++){var f=i.magical_properties[n+u];if(null==f)throw new Error("Cannot find Magical Property for id: "+n+" at position "+(e+r));if(f.sP){var h=c._readBits(t,e,r,f.sP);switch(r+=f.sP,f.dF){case 14:s.push(7&h),h=h>>3&8191}switch(f.e){case 1:break;case 2:case 3:s.push(63&h),h=h>>6&1023}s.push(h)}if(!f.sB)throw new Error("Save Bits is undefined for stat: "+n+":"+f.s+" at position "+(e+r));var l=c._readBits(t,e,r,f.sB);switch(r+=f.sB,f.sA&&(l-=f.sA),f.e){case 3:s.push(l>>8&255),s.push(255&l);break;default:s.push(l)}}a.push({id:n,values:s,name:i.magical_properties[n].s}),n=c._readBits(t,e,r,9),r+=9}return{offset:r,magic_attributes:a}}function g(t,e,r,i,n){if(e)for(var a=0;a<e.length;a++){var s=e[a];c._writeBits(t,s.id,r,i,9),i+=9;for(var o=n.magical_properties[s.id].np||1,u=0;u<o;u++){var f=n.magical_properties[s.id+u];if(null==f)throw new Error("Cannot find Magical Property for id: "+s.id);if(f.sP){var h=s.values.shift();switch(f.dF){case 14:h|=(8191&s.values.shift())<<3}switch(f.e){case 1:break;case 2:case 3:h|=(1023&s.values.shift())<<6}c._writeBits(t,h,r,i,f.sP),i+=f.sP}var l=s.values.shift();switch(f.sA&&(l+=f.sA),f.e){case 3:l|=(255&s.values.shift())<<8}if(!f.sB)throw new Error("Save Bits is undefined for stat: "+s.id+":"+f.s);c._writeBits(t,l,r,i,f.sB),i+=f.sB}}return c._writeBits(t,511,r,i,9),i+=9}!function(t){t[t.Armor=1]="Armor",t[t.Shield=2]="Shield",t[t.Weapon=3]="Weapon",t[t.Other=4]="Other"}(a||(a={})),function(t){t[t.Low=1]="Low",t[t.Normal=2]="Normal",t[t.Superior=3]="Superior",t[t.Magic=4]="Magic",t[t.Set=5]="Set",t[t.Rare=6]="Rare",t[t.Unique=7]="Unique",t[t.Crafted=8]="Crafted"}(s||(s={})),e.readCharItems=function(t,e,r,a){return i(this,void 0,void 0,function(){return n(this,function(i){return t.items=f(e,r,a),[2]})})},e.writeCharItems=function(t,e,r){return i(this,void 0,void 0,function(){var i;return n(this,function(n){return(i=(new u.BinaryWriter).SetLittleEndian()).WriteArray(h(t.items,e,r)),[2,i.toArray()]})})},e.readMercItems=function(t,e,r,a){return i(this,void 0,void 0,function(){return n(this,function(i){if(t.merc_items=[],"jf"!==e.ReadString(2))throw new Error("Mercenary header 'jf' not found at position "+(e.Position()-2));return t.header.merc_id&&0!==parseInt(t.header.merc_id,16)&&(t.merc_items=f(e,r,a)),[2]})})},e.writeMercItems=function(t,e,r){return i(this,void 0,void 0,function(){var i;return n(this,function(n){return(i=(new u.BinaryWriter).SetLittleEndian()).WriteString("jf"),t.header.merc_id&&0!==parseInt(t.header.merc_id,16)&&(t.merc_items=t.merc_items||[],i.WriteArray(h(t.merc_items,e,r))),[2,i.toArray()]})})},e.readGolemItems=function(t,e,r,a){return i(this,void 0,void 0,function(){return n(this,function(i){if("kf"!==e.ReadString(2))throw new Error("Golem header 'kf' not found at position "+(e.Position()-2));return 1===e.ReadUInt8()&&(t.golem_item=l(e,r,a)),[2]})})},e.writeGolemItems=function(t,e,r){return i(this,void 0,void 0,function(){var i;return n(this,function(n){return(i=(new u.BinaryWriter).SetLittleEndian()).WriteString("kf"),t.golem_item?(i.WriteUInt8(1),i.WriteArray(d(t.golem_item,e,r))):i.WriteUInt8(0),[2,i.toArray()]})})},e.readCorpseItems=function(t,e,r,a){return i(this,void 0,void 0,function(){var i;return n(this,function(n){if(t.corpse_items=[],"JM"!==e.ReadString(2))throw new Error("Corpse header 'JM' not found at position "+(e.Position()-2));for(t.is_dead=e.ReadUInt16(),i=0;i<t.is_dead;i++)e.Skip(12),t.corpse_items=t.corpse_items.concat(f(e,r,a));return[2]})})},e.writeCorpseItem=function(t,e,r){return i(this,void 0,void 0,function(){var i;return n(this,function(n){return(i=(new u.BinaryWriter).SetLittleEndian()).WriteString("JM"),i.WriteUInt16(t.is_dead),t.is_dead&&(i.Skip(12),t.corpse_items=t.corpse_items||[],i.WriteArray(h(t.corpse_items,e,r))),[2,i.toArray()]})})},e.readItems=f,e.writeItems=h,e.readItem=l,e.writeItem=d},function(t,e,r){"use strict";var i=this&&this.__awaiter||function(t,e,r,i){return new(r||(r=Promise))(function(n,a){function s(t){try{u(i.next(t))}catch(t){a(t)}}function o(t){try{u(i.throw(t))}catch(t){a(t)}}function u(t){t.done?n(t.value):new r(function(e){e(t.value)}).then(s,o)}u((i=i.apply(t,e||[])).next())})},n=this&&this.__generator||function(t,e){var r,i,n,a,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){s.label=a[1];break}if(6===a[0]&&s.label<n[1]){s.label=n[1],n=a;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(a);break}n[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}};function a(t,e){return i(this,void 0,void 0,function(){var r;return n(this,function(i){return r=t.items.filter(function(t){return 1===t.location_id&&13!==t.equipped_id&&14!==t.equipped_id}),t.item_bonuses=[].concat.apply([],r.map(function(t){return f(t,e)})).filter(function(t){return null!=t}),t.item_bonuses=h(t.item_bonuses,e),u(t.item_bonuses,e,t.attributes.level),[2]})})}function s(t,e,r,a){return void 0===r&&(r=1),i(this,void 0,void 0,function(){var i,u,c;return n(this,function(n){if(!t)return[2];for(i=0,u=t;i<u.length;i++)(c=u[i])&&(c.socketed_items&&c.socketed_items.length&&s(c.socketed_items,e,r,c),o(c,e,r,a));return[2]})})}function o(t,e,r,i){if(void 0===r&&(r=1),i){var n=e.armor_items[i.type]||e.weapon_items[i.type]||e.other_items[t.type],a=e.other_items[t.type];a.m&&(t.magic_attributes=function(t,e){for(var r=[],i=0,n=t;i<n.length;i++)for(var a=n[i],s=e.properties[a.m]||[],o=0;o<s.length;o++){var u=s[o],f=u.s;switch(u.f){case 5:f="mindamage";break;case 6:f="maxdamage";break;case 7:f="item_maxdamage_percent";break;case 20:f="item_indesctructible"}var h=c(f,e),l=e.magical_properties[h];l.np&&(o+=l.np);var d=[a.min,a.max];a.p&&d.push(a.p),r.push({id:h,values:d,name:l.s})}return r}(a.m[n.gt],e))}var s=null;if(e.armor_items[t.type])s=e.armor_items[t.type];else if(e.weapon_items[t.type]){var o={};(s=e.weapon_items[t.type]).mind&&(o.mindam=s.mind),s.maxd&&(o.maxdam=s.maxd),s.min2d&&(o.twohandmindam=s.min2d),s.max2d&&(o.twohandmaxdam=s.max2d),t.base_damage=o}else e.other_items[t.type]&&(s=e.other_items[t.type]);if(s)if(s.rs&&(t.reqstr=s.rs),s.rd&&(t.reqdex=s.rd),s.i&&(t.inv_file=s.i),s.ih&&(t.inv_height=s.ih),s.iw&&(t.inv_width=s.iw),s.it&&(t.inv_transform=s.it),t.multiple_pictures&&(t.inv_file=s.ig[t.picture_id]),t.magic_prefix||t.magic_suffix)t.magic_prefix&&e.magic_prefixes[t.magic_prefix].tc&&(t.transform_color=e.magic_prefixes[t.magic_prefix].tc),t.magic_suffix&&e.magic_suffixes[t.magic_suffix].tc&&(t.transform_color=e.magic_suffixes[t.magic_suffix].tc);else if(t.magical_name_ids&&6===t.magical_name_ids.length)for(var l=0;l<6;l++){var d=t.magical_name_ids[l];d&&(l%5==0&&e.magic_suffixes[d].tc?t.transform_color=e.magic_suffixes[d].tc:e.magic_prefixes[d].tc&&(t.transform_color=e.magic_prefixes[d].tc))}else if(t.unique_id){var _=e.unq_items[t.unique_id];s.ui&&(t.inv_file=s.ui),_&&_.i&&(t.inv_file=_.i),_&&_.tc&&(t.transform_color=_.tc)}else if(t.set_id){var p=e.set_items[t.set_id];s.ui&&(t.inv_file=s.ui),p&&p.i&&(t.inv_file=p.i),p&&p.tc&&(t.transform_color=p.tc)}(t.magic_attributes||t.runeword_attributes||t.socketed_items)&&(u(t.magic_attributes,e,r),u(t.runeword_attributes,e,r),t.combined_magic_attributes=h(f(t,e),e),u(t.combined_magic_attributes,e,r))}function u(t,e,r){if(void 0===r&&(r=1),t){for(var i=[0,0,0],n=[0,0,0],a=0,s=t;a<s.length;a++){var o=s[a],u=e.magical_properties[o.id],c=o.values[o.values.length-1];u.dg&&(0===n[u.dg-1]&&(n[u.dg-1]=c),n[u.dg-1]-c==0&&i[u.dg-1]++)}for(var f=function(t){var a=e.magical_properties[t.id];if(null==a)throw new Error("Cannot find Magical Property for id: "+t.id);var s=t.values[t.values.length-1];if("level"===a.ob){switch(a.o){case 1:s=Math.floor(r*s/100);break;case 2:case 3:case 4:case 5:s=Math.floor(r*s/Math.pow(2,a.op))}t.op_stats=a.os,t.op_value=s}var o=a.dF,u=s>=0?a.dP:a.dN,c=a.dV,f=a.d2;if(a.dg&&4===i[a.dg-1]&&(u=(s=n[a.dg-1])>=0?a.dgP:a.dgN,c=a.dgV,o=a.dgF,f=a.dg2),a.np){var h=0;u=a.dR,"poisonmindam"===a.s&&(t.values[2]=Math.floor(t.values[2]/25),t.values[0]=Math.floor(t.values[0]/t.values[2]),t.values[1]=Math.floor(t.values[1]/t.values[2])),t.values[0]===t.values[1]&&(h++,u=a.dE,"item_maxdamage_percent"===a.s&&(u="+%d% "+u.replace(/}/gi,""))),t.description=u.replace(/%d/gi,function(){return t.values[h++]})}else!function(t,e,r,i,n,a,s){if(!i)return;var o=r>=0?"+":"",u=null,c=i>=6&&i<=10;switch(i){case 1:case 6:case 12:u=""+o+r;break;case 2:case 7:u=r+"%";break;case 3:case 9:u=""+r;break;case 4:case 8:u=""+o+r+"%";break;case 5:case 10:u=100*r/128+"%";break;case 11:t.description=a.replace(/%d/,(r/100).toString());break;case 13:var f=e.classes[t.values[0]];t.description=""+o+r+" "+f.as;break;case 14:var h=(f=e.classes[t.values[1]]).ts[t.values[0]];a=h.replace(/%d/gi,r),t.description=a+" "+f.co;break;case 15:var l=2;a=a.replace(/%d%|%s/gi,function(){var r=t.values[l--];return 0==l?e.skills[r].s:r}).replace(/%d/,t.values[l--].toString()),t.description=""+a;break;case 16:t.description=a.replace(/%d/,r.toString()),t.description=t.description.replace(/%s/,e.skills[t.values[0]].s);break;case 17:t.description=r+" "+a+" (Increases near [time])";break;case 18:t.description=r+"% "+a+" (Increases near [time])";break;case 19:t.description=a.replace(/%d/,r.toString());break;case 20:u=-1*r+"%";break;case 21:u=""+-1*r;break;case 22:t.description=r+"% "+a+" [montype]";break;case 23:t.description=r+"% "+a+" [monster]]";break;case 24:var d=0;a=a.replace(/%d/gi,function(){return t.values[2+d++].toString()}),t.description="Level "+t.values[0]+" "+e.skills[t.values[1]].s+" "+a;break;case 27:f=function(t,e){return e.classes.filter(function(e){return e.c===t})[0]}((_=e.skills[t.values[0]]).c,e);t.description=""+o+r+" to "+_.s+" "+f.co;break;case 28:var _=e.skills[t.values[0]];t.description=""+o+r+" to "+_.s;break;default:throw new Error("No handler for descFunc: "+i)}if(u)switch(n){case 0:t.description=""+a;break;case 1:t.description=u+" "+a;break;case 2:t.description=a+" "+u;break;default:throw new Error("No handler for descVal: "+n)}c&&(t.description+=" "+s)}(t,e,s,o,c,u,f)},h=0,l=t;h<l.length;h++){f(o=l[h])}t.sort(function(t,r){return e.magical_properties[r.id].so-e.magical_properties[t.id].so});for(var d=t.length-1;d>0;d--)t[d].description===t[d-1].description&&(t[d-1].visible=!1)}}function c(t,e){return e.magical_properties.findIndex(function(e){return e.s===t})}function f(t,e){var r=[];if(t.socketed_items)for(var i=0,n=t.socketed_items;i<n.length;i++){var a=n[i];r=r.concat.apply(r,a.magic_attributes)}var s=t.magic_attributes||[],o=t.runeword_attributes||[];return[].concat(s,o,r).filter(function(t){return null!=t})}function h(t,e){for(var r=[],i=function(t){var i=e.magical_properties[t.id],n=r.filter(function(e){return 3===i.e?e.id===t.id&&e.values[0]===t.values[0]&&e.values[1]===t.values[1]:e.id===t.id});if(n&&n.length)for(var a=0;a<n.length;a++){var s=n[a];if(i.np){s.values[0]+=t.values[0],s.values[1]+=t.values[1];break}for(var o=!0,u=3===i.e?2:1,c=0;c<s.values.length-u&&(o=s.values[c]===t.values[c]);c++);if(o)for(c=1;c<=u;c++){var f=s.values.length-c;s.values[f]+=t.values[f]}else r.push({id:t.id,values:t.values,name:t.name})}else r.push({id:t.id,values:t.values,name:t.name})},n=0,a=t;n<a.length;n++){i(a[n])}return r}Object.defineProperty(e,"__esModule",{value:!0}),e.enhanceAttributes=function(t,e){return i(this,void 0,void 0,function(){return n(this,function(r){return s(t.items,e,t.attributes.level),s([t.golem_item],e,t.attributes.level),s(t.merc_items,e,t.attributes.level),s(t.corpse_items,e,t.attributes.level),a(t,e),[2]})})},e.enhancePlayerAttributes=a,e.enhanceItems=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={item_maxdamage_percent:{numprops:2,rangestr:"strModMinDamageRange",equalstr:"strModEnhancedDamage"},firemindam:{numprops:2,rangestr:"strModFireDamageRange",equalstr:"strModFireDamage"},lightmindam:{numprops:2,rangestr:"strModLightningDamageRange",equalstr:"strModLightningDamage"},magicmindam:{numprops:2,rangestr:"strModMagicDamageRange",equalstr:"strModMagicDamage"},coldmindam:{numprops:3,rangestr:"strModColdDamageRange",equalstr:"strModColdDamage"},poisonmindam:{numprops:3,rangestr:"strModPoisonDamageRange",equalstr:"strModPoisonDamage"}};function n(t,e){return r=a(t,e),{header:(i=r.split(/\r?\n/).map(function(t){return t.split(/\t/)}))[0],lines:i};var r,i}function a(t,e){var r=Object.keys(t).find(function(t){return t.toLowerCase()===e.toLowerCase()});if(!r)throw new Error("Cannot find file: "+e);return t[r]}function s(t){var e={};return t.split(/\r?\n/).map(function(t){return t.split(/\t/)}).map(function(t){e[t[0]]||(e[t[0]]=t[1])}),e}function o(t,e,r){for(var i=[],n=t.header.indexOf("name"),a=e,s=1;s<t.lines.length;s++){var o=t.lines[s][n];o&&(i[a-e]={n:r[o]},a++)}return i}function u(t,e){for(var r=[],i=t.header.indexOf("Name"),n=t.header.indexOf("transformcolor"),a=1,s=1;s<t.lines.length;s++){var o=t.lines[s][i];if("Expansion"!=o){var u={};u.n=e[o],t.lines[s][n]&&(u.tc=t.lines[s][n]),r[a]=u,a++}}return r}function c(t,e,r){for(var i=[],n=t.header.indexOf("code"),a=t.header.indexOf("namestr"),s=t.header.indexOf("stackable"),o=t.header.indexOf("mindam"),u=t.header.indexOf("maxdam"),c=t.header.indexOf("2handmindam"),f=t.header.indexOf("2handmaxdam"),h=t.header.indexOf("minmisdam"),l=t.header.indexOf("maxmisdam"),d=t.header.indexOf("reqstr"),_=t.header.indexOf("reqdex"),p=t.header.indexOf("gemapplytype"),g=t.header.indexOf("invfile"),m=t.header.indexOf("uniqueinvfile"),v=t.header.indexOf("setinvfile"),y=t.header.indexOf("invwidth"),w=t.header.indexOf("invheight"),B=t.header.indexOf("InvTrans"),b=t.header.indexOf("type"),A=1;A<t.lines.length;A++){var k=t.lines[A][n];if(k){var E={};E.code=k,E.n=r[t.lines[A][a]],t.lines[A][s]&&+t.lines[A][s]>0&&(E.s=1),t.lines[A][o]&&+t.lines[A][o]>0&&(E.mind=+t.lines[A][o]),t.lines[A][u]&&+t.lines[A][u]>0&&(E.maxd=+t.lines[A][u]),t.lines[A][c]&&+t.lines[A][c]>0&&(E.min2d=+t.lines[A][c]),t.lines[A][f]&&+t.lines[A][f]>0&&(E.max2d=+t.lines[A][f]),t.lines[A][h]&&+t.lines[A][h]>0&&(E.minmd=+t.lines[A][h]),t.lines[A][l]&&+t.lines[A][l]>0&&(E.maxmd=+t.lines[A][l]),t.lines[A][d]&&(E.rs=+t.lines[A][d]),t.lines[A][_]&&(E.rd=+t.lines[A][_]),t.lines[A][p]&&(E.gt=+t.lines[A][p]),t.lines[A][g]&&(E.i=t.lines[A][g]),t.lines[A][m]&&(E.ui=t.lines[A][m]),t.lines[A][v]&&(E.si=t.lines[A][v]),t.lines[A][y]&&(E.iw=+t.lines[A][y]),t.lines[A][w]&&(E.ih=+t.lines[A][w]),t.lines[A][B]&&(E.it=+t.lines[A][B]);var x=e[t.lines[A][b]];x&&x.ig&&(E.ig=x.ig),i.push(E)}}return i}function f(t,e){for(var r=[],i=t.header.indexOf("index"),n=t.header.indexOf("invfile"),a=t.header.indexOf("code"),s=t.header.indexOf("invtransform"),o=0,u=1;u<t.lines.length;u++){var c=t.lines[u][i];if(c&&"Expansion"!=c){var f={};f.n=e[t.lines[u][i]],t.lines[u][n]&&(f.i=t.lines[u][n]),t.lines[u][a]&&(f.c=t.lines[u][a]),t.lines[u][s]&&(f.tc=t.lines[u][s]),r[o]=f,o++}}return r}e.readConstantData=function(t){var e={},r=s(a(t,"string.txt"));r=Object.assign(r,s(a(t,"expansionstring.txt"))),r=Object.assign(r,s(a(t,"patchstring.txt"))),e.classes=function(t,e,r){for(var i=[],n=t.header.indexOf("class"),a=t.header.indexOf("StrAllSkills"),s=t.header.indexOf("StrSkillTab1"),o=t.header.indexOf("StrSkillTab2"),u=t.header.indexOf("StrSkillTab3"),c=t.header.indexOf("StrClassOnly"),f=e.header.indexOf("Code"),h=0,l=1;l<t.lines.length;l++){var d=t.lines[l][n];d&&"Expansion"!=d&&(i[h]={n:d,c:e.lines[l][f],as:r[t.lines[l][a]],ts:[r[t.lines[l][s]],r[t.lines[l][o]],r[t.lines[l][u]]],co:r[t.lines[l][c]]},h++)}return i}(n(t,"CharStats.txt"),n(t,"PlayerClass.txt"),r);var h=function(t,e){for(var r={},i=t.header.indexOf("skilldesc"),n=t.header.indexOf("str name"),a=1;a<t.lines.length;a++){var s=t.lines[a][i],o=t.lines[a][n];s&&o&&(r[s]=e[o])}return r}(n(t,"SkillDesc.txt"),r);e.skills=function(t,e,r){for(var i=[],n=t.header.indexOf("skilldesc"),a=t.header.indexOf("Id"),s=t.header.indexOf("charclass"),o=1;o<t.lines.length;o++){var u=+t.lines[o][a],c=t.lines[o][n];if(c){var f={};e[c]&&(f.s=e[c]),t.lines[o][s]&&(f.c=t.lines[o][s]),i[u]=f}}return i}(n(t,"skills.txt"),h),e.rare_names=[null].concat(o(n(t,"RareSuffix.txt"),1,r)),e.rare_names=e.rare_names.concat(o(n(t,"RarePrefix.txt"),e.rare_names.length,r)),e.magic_prefixes=u(n(t,"MagicPrefix.txt"),r),e.magic_suffixes=u(n(t,"MagicSuffix.txt"),r),e.properties=function(t,e){for(var r={},i=t.header.indexOf("code"),n=[],a=1;a<=7;a++)n[a]={},n[a].cStat=t.header.indexOf("stat"+a),n[a].cFunc=t.header.indexOf("func"+a);for(var s=1;s<t.lines.length;s++){var o=t.lines[s][i];if("Expansion"!=o){var u=[];for(a=1;a<=7;a++){var c=t.lines[s][n[a].cStat],f=t.lines[s][n[a].cFunc];if(!c&&!f)break;var h={};c&&(h.s=c),f&&(h.f=+f),u[a-1]=h}u.length&&(r[o]=u)}}return r}(n(t,"Properties.txt")),e.magical_properties=function(t,e){for(var r=[],n=t.header.indexOf("Stat"),a=t.header.indexOf("ID"),s=t.header.indexOf("CSvBits"),o=t.header.indexOf("CSvParam"),u=t.header.indexOf("Encode"),c=t.header.indexOf("Save Bits"),f=t.header.indexOf("Save Add"),h=t.header.indexOf("Save Param Bits"),l=t.header.indexOf("descpriority"),d=t.header.indexOf("descfunc"),_=t.header.indexOf("descval"),p=t.header.indexOf("descstrpos"),g=t.header.indexOf("descstrneg"),m=t.header.indexOf("descstr2"),v=t.header.indexOf("dgrp"),y=t.header.indexOf("dgrpfunc"),w=t.header.indexOf("dgrpval"),B=t.header.indexOf("dgrpstrpos"),b=t.header.indexOf("dgrpstrneg"),A=t.header.indexOf("dgrpstr2"),k=t.header.indexOf("op"),E=t.header.indexOf("op param"),x=t.header.indexOf("op base"),S=t.header.indexOf("op stat1"),I=t.header.indexOf("op stat2"),R=t.header.indexOf("op stat3"),U=1;U<t.lines.length;U++){var O=+t.lines[U][a],W=t.lines[U][n];if(W){var P={};P.s=W,t.lines[U][s]&&(P.cB=+t.lines[U][s]),t.lines[U][o]&&(P.cP=+t.lines[U][o]),t.lines[U][u]&&(P.e=+t.lines[U][u]),t.lines[U][c]&&(P.sB=+t.lines[U][c]),t.lines[U][f]&&(P.sA=+t.lines[U][f]),t.lines[U][h]&&(P.sP=+t.lines[U][h]),t.lines[U][l]&&(P.so=+t.lines[U][l]),t.lines[U][d]&&(P.dF=+t.lines[U][d]),t.lines[U][_]&&(P.dV=+t.lines[U][_]),t.lines[U][p]&&(P.dP=e[t.lines[U][p]]),t.lines[U][g]&&(P.dN=e[t.lines[U][g]]),t.lines[U][m]&&(P.d2=e[t.lines[U][m]]),t.lines[U][v]&&(P.dg=+t.lines[U][v]),t.lines[U][y]&&(P.dgF=+t.lines[U][y]),t.lines[U][w]&&(P.dgV=+t.lines[U][w]),t.lines[U][B]&&(P.dgP=e[t.lines[U][B]]),t.lines[U][b]&&(P.dN=e[t.lines[U][b]]),t.lines[U][A]&&(P.dg2=e[t.lines[U][A]]),t.lines[U][k]&&(P.o=+t.lines[U][k]),t.lines[U][E]&&(P.op=+t.lines[U][E]),t.lines[U][x]&&(P.ob=t.lines[U][x]),t.lines[U][S]&&(P.os=[t.lines[U][S]]),t.lines[U][I]&&(P.os[1]=t.lines[U][I]),t.lines[U][R]&&(P.os[2]=t.lines[U][R]);var M=i[W];M&&(P.np=M.numprops,P.dR=e[M.rangestr],P.dE=e[M.equalstr]),r[O]=P}}return r}(n(t,"ItemStatCost.txt"),r),e.runewords=function(t,e){for(var r=[],i=t.header.indexOf("Name"),n=1;n<t.lines.length;n++){var a=t.lines[n][i];if(a){var s=+a.substring(8);r[s+=s>75?25:26]={n:e[t.lines[n][i]]}}}return r}(n(t,"Runes.txt"),r),e.set_items=f(n(t,"SetItems.txt"),r),e.unq_items=f(n(t,"UniqueItems.txt"),r);var l=function(t,e){for(var r={},i=t.header.indexOf("Code"),n=[],a=1;a<=6;a++)n.push(t.header.indexOf("InvGfx"+a));for(a=1;a<t.lines.length;a++){var s=t.lines[a][i];if(s){for(var o={},u=[],c=0;c<=6;c++)t.lines[a][n[c]]&&(u[c]=t.lines[a][n[c]]);o.ig=u,r[s]=o}}return r}(n(t,"ItemTypes.txt")),d=c(n(t,"Armor.txt"),l,r),_=c(n(t,"Weapons.txt"),l,r),p=c(n(t,"Misc.txt"),l,r);return e.stackables={},d.concat(_,p).filter(function(t){return 1===t.s}).map(function(t){return e.stackables[t.code]={n:t.n}}),e.armor_items={},d.map(function(t){e.armor_items[t.code]=t,delete t.code}),e.weapon_items={},_.map(function(t){e.weapon_items[t.code]=t,delete t.code}),e.other_items={},p.map(function(t){e.other_items[t.code]=t,delete t.code}),function(t,e,r){for(var i=e.header.indexOf("code"),n=["weapon","helm","shield"],a={},s=0,o=n;s<o.length;s++){a[d=o[s]]=[];for(var u=1;u<=3;u++)a[d][u]={},a[d][u].cMod=e.header.indexOf(d+"Mod"+u+"Code"),a[d][u].cParam=e.header.indexOf(d+"Mod"+u+"Param"),a[d][u].cMin=e.header.indexOf(d+"Mod"+u+"Min"),a[d][u].cMax=e.header.indexOf(d+"Mod"+u+"Max")}for(var c=1;c<e.lines.length;c++){var f=e.lines[c][i];if(f&&"Expansion"!=f)for(var h=t[f],l=0;l<3;l++){var d=n[l];for(u=1;u<=3;u++){var _=e.lines[c][a[d][u].cMod];if(!_)break;1==u&&(h.m||(h.m=[]),h.m[l]=[]);var p={};p.m=_,e.lines[c][a[d][u].cParam]&&(p.p=+e.lines[c][a[d][u].cParam]),e.lines[c][a[d][u].cMin]&&(p.min=+e.lines[c][a[d][u].cMin]),e.lines[c][a[d][u].cMax]&&(p.max=+e.lines[c][a[d][u].cMax]),h.m[l].push(p)}}}}(e.other_items,n(t,"Gems.txt")),e}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}]);